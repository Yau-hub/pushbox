{"version":3,"sources":["assets\\scripts\\main.js"],"names":["window","env","cc","sys","platform","WECHAT_GAME","wx","cloud","init","userInfo","classicsLevelNum","netLevelNum","levelIndex","bgUrlBase","Class","Component","properties","oneSayLabel","type","Label","loginplay","Button","visitorplay","levelLayout","Prefab","onLoad","find","getComponent","node","on","loginLevelList","visitorLevelList","start","that","callFunction","name","then","res","result","total","err","console","error","getUserInfo","loadImg","container","imgServeUrl","imgUrl","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","JSON","parse","responseText","images","urlbase","assetManager","loadRemote","texture","sprite","SpriteFrame","spriteFrame","starNode","Node","setPosition","starSprite","addComponent","Sprite","sizeMode","width","winSize","height","addChild","open","send","oneSay","url","string","hitokoto","from","loginType","CanvasNode","onResourceLoaded","errorMessage","loadedResource","log","newMyPrefab","instantiate","loader","loadRes","getStorage","key","success","appId","data","length","fail","setStorage","appid","openid","openId","login","_success","_fail","info","systemInfo","getSystemInfoSync","w","screenWidth","h","screenHeight","getSetting","authSetting","button","createUserInfoButton","text","style","left","top","backgroundColor","color","fontSize","textAlign","lineHeight","onTap","destroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\nwindow.env = \"cloud1-5gvbuiy3dd99f63c\"\r\nif (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n    wx.cloud.init({env: window.env})\r\n}\r\nwindow.userInfo = {};\r\nwindow.classicsLevelNum = 0;\r\nwindow.netLevelNum = 0;\r\nwindow.levelIndex = 0;\r\nwindow.bgUrlBase = '';\r\n\r\n\r\n\r\nimport levels from './level'\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        oneSayLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        loginplay: cc.Button,\r\n        visitorplay: cc.Button,\r\n        levelLayout: cc.Prefab,\r\n\r\n    },\r\n\r\n\r\n\r\n\r\n    // LIFE-CYCL:E CALLBACKS:\r\n\r\n     onLoad () {\r\n        //加载一言\r\n        //  this.oneSay();\r\n\r\n         //开始游戏按钮\r\n         if(this.loginplay == null) this.loginplay = cc.find('Canvas/mainBg/loginplay').getComponent(cc.Button)\r\n         this.loginplay.node.on('click', this.loginLevelList, this)\r\n         if(this.visitorplay == null) this.visitorplay = cc.find('Canvas/mainBg/visitorplay').getComponent(cc.Button)\r\n         this.visitorplay.node.on('click', this.visitorLevelList, this)\r\n\r\n\r\n\r\n     },\r\n\r\n    start () {\r\n        let that = this;\r\n\r\n\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME){\r\n            // wx.cloud.callFunction({\r\n            //     name: 'addClassicsLevel',\r\n            //     data:{\r\n            //         content: levels[0],\r\n            //         levelIndex: 1\r\n            //     }\r\n            // }).then(res => {\r\n            //     console.log(res)\r\n            // }).catch(err => {\r\n            //     console.error(err)\r\n            // })\r\n\r\n\r\n            wx.cloud.callFunction({\r\n                name: 'getClassicsLevelNum'\r\n            }).then(res => {\r\n                window.classicsLevelNum = res.result.total;\r\n            }).catch(err => {\r\n                console.error(err)\r\n            })\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n        // this.loadImg();\r\n        //\r\n        // setInterval(function () {\r\n        //     that.oneSay();\r\n        // },10000)\r\n\r\n        this.getUserInfo();\r\n\r\n        // this.login();\r\n    },\r\n\r\n\r\n    // update (dt) {},\r\n\r\n\r\n\r\n    loadImg: function(){\r\n        var that = this;\r\n        let container = cc.find('Canvas/mainBg/bingBg');//图片呈现位置\r\n        var imgServeUrl = 'https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1';\r\n        var imgUrl = '';\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                var response =  JSON.parse(xhr.responseText);\r\n                imgUrl = 'https://cn.bing.com' + response.images[0].urlbase + '_720x1280.jpg'\r\n                window.bgUrlBase = 'https://cn.bing.com' + response.images[0].urlbase;\r\n\r\n                cc.assetManager.loadRemote(imgUrl, function (err, texture) {\r\n                    var sprite  = new cc.SpriteFrame(texture);\r\n                    container.spriteFrame = sprite;\r\n                    //创建一个使用图片资源的新节点对象\r\n                    let starNode = new cc.Node(); //创建一个新节点\r\n                    starNode.name = \"star1\";\r\n                    starNode.setPosition(0,0);\r\n                    let starSprite = starNode.addComponent(cc.Sprite); //增加精灵组件\r\n                    starSprite.spriteFrame = sprite; //设置精灵组件图片资源\r\n                    starSprite.sizeMode = 'CUSTOM';\r\n                    starSprite.node.width = cc.winSize.width\r\n                    starSprite.node.height = cc.winSize.height\r\n                    container.addChild(starNode); //场景中增加新节点\r\n                });\r\n            }\r\n        };\r\n        xhr.open(\"get\", imgServeUrl, true);\r\n        xhr.send();\r\n    },\r\n    oneSay(){\r\n        let that = this;\r\n        let url = \"https://v1.hitokoto.cn/\";\r\n        let xhr = new XMLHttpRequest();\r\n        let oneSayLabel = cc.find(\"Canvas/mainBg/oneSay\").getComponent(cc.Component);\r\n\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                var response =  JSON.parse(xhr.responseText);\r\n               if(that.oneSayLabel && that.oneSayLabel.string != null) that.oneSayLabel.string = response.hitokoto + ' -- ' +  response.from;\r\n               else if(oneSayLabel && oneSayLabel.string != null ) oneSayLabel.string = response.hitokoto + ' -- ' +  response.from;\r\n            }\r\n        };\r\n        xhr.open(\"get\", url, true);\r\n        xhr.send();\r\n    },\r\n    //授权登录显示关卡列表\r\n    loginLevelList(){\r\n\r\n\r\n        window.loginType = 'wechat';\r\n        var CanvasNode = cc.find('Canvas');\r\n        if( !CanvasNode ) { cc.console( 'find Canvas error' ); return; }\r\n        var onResourceLoaded = function(errorMessage, loadedResource )\r\n        {\r\n            if( errorMessage ) { console.log( 'Prefab error:' + errorMessage ); return; }\r\n            if( !( loadedResource instanceof cc.Prefab ) ) { console.log( 'Prefab error' ); return; }\r\n            var newMyPrefab = cc.instantiate( loadedResource );\r\n            CanvasNode.addChild( newMyPrefab );\r\n        };\r\n        cc.loader.loadRes('levelLayout', onResourceLoaded );\r\n\r\n        // let levelList = cc.instantiate(this.levelLayout);\r\n        // this.node.addChild(levelList);\r\n    },\r\n    //不登录登录显示关卡列表\r\n    visitorLevelList(){\r\n\r\n\r\n        window.loginType = 'visitor';\r\n        var CanvasNode = cc.find('Canvas');\r\n        if( !CanvasNode ) { cc.console( 'find Canvas error' ); return; }\r\n        var onResourceLoaded = function(errorMessage, loadedResource )\r\n        {\r\n            if( errorMessage ) { console.log( 'Prefab error:' + errorMessage ); return; }\r\n            if( !( loadedResource instanceof cc.Prefab ) ) { console.log( 'Prefab error' ); return; }\r\n            var newMyPrefab = cc.instantiate( loadedResource );\r\n            CanvasNode.addChild( newMyPrefab );\r\n        };\r\n        cc.loader.loadRes('levelLayout', onResourceLoaded );\r\n\r\n        // let levelList = cc.instantiate(this.levelLayout);\r\n        // this.node.addChild(levelList);\r\n    },\r\n    getUserInfo(){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            //获取缓存appId判断是否第一次进入游戏\r\n            wx.getStorage({\r\n                key: 'appId',\r\n                success (res) {\r\n                    window.userInfo.appId = res.data;\r\n                    wx.cloud.callFunction({\r\n                        name: 'queryUser',\r\n                        data:{\r\n                            appId: window.userInfo.appId\r\n                        }\r\n                    }).then(res => {\r\n                        if(res && res.result.data.length>0){\r\n                            window.userInfo.classicsLevelNum = res.result.data[0].classicsLevelNum;\r\n                            window.userInfo.netLevelNum = res.result.data[0].netLevelNum;\r\n                        }\r\n\r\n                    }).catch(err => {\r\n                        console.error(err)\r\n                    })\r\n                },\r\n                fail(err){\r\n\r\n                    wx.cloud.callFunction({\r\n                        name: 'login'\r\n                    }).then(res => {\r\n                        if(res && res.result){\r\n                            wx.setStorage({\r\n                                key: \"appId\",\r\n                                data:res.result.appid\r\n                            })\r\n                            wx.setStorage({\r\n                                key: \"openId\",\r\n                                data:res.result.openid\r\n                            })\r\n                            window.userInfo.appId = res.result.appid;\r\n                            window.userInfo.classicsLevelNum = 0\r\n                            window.userInfo.netLevelNum = 0\r\n\r\n                            //注册用户信息\r\n                            wx.cloud.callFunction({\r\n                                name: 'addUser',\r\n                                data: {\r\n                                    appId: res.result.appid,\r\n                                    openId: res.result.openid\r\n                                }\r\n                            }).then(res => {\r\n                                console.log(res)\r\n                            }).catch(err => {\r\n                                console.error(err)\r\n                            })\r\n                        }\r\n                    }).catch(err => {\r\n                        console.error(err)\r\n                    })\r\n\r\n                }\r\n            })\r\n        }\r\n    },\r\n    login(_success, _fail){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            //微信登陆\r\n            const wx = window['wx'];//避开ts语法检测\r\n            const info = systemInfo = wx.getSystemInfoSync();//立即获取系统信息\r\n            const w = screenWidth = info.screenWidth;//屏幕宽\r\n            const h = screenHeight = info.screenHeight;//屏幕高\r\n\r\n            //获取用户的当前设置。返回值中只会出现小程序已经向用户请求过的权限。\r\n            wx.getSetting(\r\n                {\r\n                    success(res) {\r\n                        console.log(res.authSetting);\r\n                        if (res.authSetting[\"scope.userInfo\"]) {\r\n                            console.log(\"用户已授权\");\r\n                            wx.getUserInfo({\r\n                                success(res) {\r\n                                    //登陆操作\r\n                                    userInfo = res.userInfo;\r\n                                    _success && _success(res.userInfo);\r\n                                }\r\n                            });\r\n                        } else {\r\n                            console.log(\"用户未授权\");\r\n\r\n                            //创建全屏透明登陆按钮\r\n                            let button = wx.createUserInfoButton({\r\n                                type: 'text',\r\n                                text: '',\r\n                                style: {\r\n                                    left: 0,\r\n                                    top: 0,\r\n                                    width: w,\r\n                                    height: h,\r\n                                    backgroundColor: '#00000000',//最后两位为透明度\r\n                                    color: '#ffffff',\r\n                                    fontSize: 20,\r\n                                    textAlign: \"center\",\r\n                                    lineHeight: h,\r\n                                }\r\n                            });\r\n\r\n                            button.onTap((res) => {\r\n                                if (res.userInfo) {\r\n                                    console.log(\"用户授权:\", res.userInfo);\r\n                                    userInfo = res.userInfo;\r\n                                    _success && _success(res.userInfo);\r\n                                    button.destroy();\r\n                                } else {\r\n                                    console.log(\"用户拒绝授权:\");\r\n                                    _fail && _fail();\r\n                                }\r\n                            });\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n            );\r\n            return ;\r\n        }\r\n    }\r\n});\r\n"]}