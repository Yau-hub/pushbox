window.__require=function e(n,i,t){function o(c,l){if(!i[c]){if(!n[c]){var r=c.split("/");if(r=r[r.length-1],!n[r]){var a="function"==typeof __require&&__require;if(!l&&a)return a(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var d=i[c]={exports:{}};n[c][0].call(d.exports,function(e){return o(n[c][1][e]||e)},d,d.exports,e,n,i,t)}return i[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<t.length;c++)o(t[c]);return o}({common:[function(e,n){"use strict";cc._RF.push(n,"db8b31XBphC44pnJIdLHrEO","common"),cc._RF.pop()},{}],eleSize:[function(e,n){"use strict";cc._RF.push(n,"492ddrnQNVDwqTjOokjYqHi","eleSize"),cc.Class({extends:cc.Component,properties:{},start:function(){this.node.width=this.node.height=window.eleSize}}),cc._RF.pop()},{}],gameLayout:[function(e,n){"use strict";var i;cc._RF.push(n,"8bc72A5qvpI1ZnhM9AbJxE6","gameLayout"),(i=e("./level"))&&i.__esModule,window.currentLevel=[],window.eleSize=35,window.layout=new Array,window.blockNum=12,cc.Class({extends:cc.Component,properties:{block:{default:null,type:cc.Prefab,displayName:"block"},wall:{default:null,type:cc.Prefab,displayName:"wall"},box:{default:null,type:cc.Prefab,displayName:"box"},ball:{default:null,type:cc.Prefab,displayName:"ball"},roleUp:{default:null,type:cc.Prefab,displayName:"roleUp"},roleRight:{default:null,type:cc.Prefab,displayName:"roleRight"},roleDown:{default:null,type:cc.Prefab,displayName:"roleDown"},roleLeft:{default:null,type:cc.Prefab,displayName:"roleLeft"},position:{default:null},gameBn:cc.Sprite,boxNum:{default:null},stepCounter:null,stepCounterValue:0,timeCounter:null,timeCounterValue:0,timeCounterTimer:null,levelCounter:null},onLoad:function(){this.initWinEle(),this.renderBg(),this.initLevel(),cc.find("gameBtns",this.node).height=(cc.winSize.height-cc.winSize.width)/2},start:function(){this.addTouchMove(),this.pendantAddEvent()},initWinEle:function(){var e=cc.winSize.width/window.blockNum;window.eleSize=e;for(var n=0;n<window.blockNum;n++){window.layout[n]=new Array;for(var i=0;i<window.blockNum;i++)window.layout[n][i]={x:0,y:0,sign:0,cover:null}}},initPosition:function(e){this.position={},this.boxNum=0;for(var n=0;n<e.length;n++)for(var i=0;i<e[0].length;i++)4!=e[n][i].sign&&5!=e[n][i].sign&&6!=e[n][i].sign&&7!=e[n][i].sign||(this.position.x=i,this.position.y=n),2==e[n][i].sign&&this.boxNum++},renderBg:function(){for(var e=-cc.winSize.width/2,n=window.eleSize*window.blockNum/2,i=0;i<window.blockNum;i++)for(var t=0;t<window.blockNum;t++){var o=t*window.eleSize+e,s=-i*window.eleSize+n;window.layout[i][t]={x:o,y:s,sign:0,cover:null};var c=cc.instantiate(this.block);c.setPosition(o,s),this.node.addChild(c)}},renderBn:function(){null==this.gameBn&&(this.gameBn=cc.find("Canvas/mainBg/gameBn").getComponent(cc.Sprite)),cc.assetManager.loadRemote(window.bgUrlBase+"_400x240.jpg",function(e,n){var i=new cc.SpriteFrame(n,cc.rect(0,0,400,240));that.gameBn.spriteFrame=i})},renderLayout:function(e){this.renderBg();for(var n=0;n<window.blockNum;n++)for(var i=0;i<window.blockNum;i++){var t=window.layout[n][i].x,o=window.layout[n][i].y;switch(e[n][i].sign){case 0:var s=cc.instantiate(this.block);s.setPosition(t,o),this.node.addChild(s);break;case 1:var c=cc.instantiate(this.wall);c.setPosition(t,o),this.node.addChild(c);break;case 2:var l=cc.instantiate(this.box);l.setPosition(t,o),this.node.addChild(l);break;case 3:var r=cc.instantiate(this.ball);r.setPosition(t,o),this.node.addChild(r);break;case 4:var a=cc.instantiate(this.roleUp);a.setPosition(t,o),this.node.addChild(a);break;case 5:var d=cc.instantiate(this.roleRight);d.setPosition(t,o),this.node.addChild(d);break;case 6:var u=cc.instantiate(this.roleDown);u.setPosition(t,o),this.node.addChild(u);break;case 7:var g=cc.instantiate(this.roleLeft);g.setPosition(t,o),this.node.addChild(g)}}},moveUp:function(e){var n=this,i=this.position.x,t=this.position.y;0==e[t-1][i].sign?(e[t-1][i].sign=4,e[t][i].sign=0,this.resetPosition("up")):1==e[t-1][i].sign?e[t][i].sign=4:2==e[t-1][i].sign?0==e[t-2][i].sign?(e[t][i].sign=0,e[t-2][i].sign=2,e[t-1][i].sign=4,e[t-1][i].cover&&(e[t-1][i].cover=4),this.resetPosition("up")):3==e[t-2][i].sign?(e[t][i].sign=0,e[t-2][i].sign=2,e[t-2][i].cover=2,e[t-1][i].sign=4,e[t-1][i].cover&&(e[t-1][i].cover=4),this.resetPosition("up")):e[t][i].sign=4:3==e[t-1][i].sign&&(e[t][i].sign=0,e[t-1][i].sign=4,e[t-1][i].cover=4,this.resetPosition("up")),0==e[t][i].sign&&e[t][i].cover&&(e[t][i].sign=3,e[t][i].cover=null);var o=setTimeout(function(){n.renderLayout(e),clearTimeout(o)})},moveDown:function(e){var n=this,i=this.position.x,t=this.position.y;0==e[t+1][i].sign?(e[t+1][i].sign=6,e[t][i].sign=0,this.resetPosition("down")):1==e[t+1][i].sign?e[t][i].sign=6:2==e[t+1][i].sign?0==e[t+2][i].sign?(e[t][i].sign=0,e[t+2][i].sign=2,e[t+1][i].sign=6,e[t+1][i].cover&&(e[t+1][i].cover=6),this.resetPosition("down")):3==e[t+2][i].sign?(e[t][i].sign=0,e[t+2][i].sign=2,e[t+2][i].cover=2,e[t+1][i].sign=6,e[t+1][i].cover&&(e[t+1][i].cover=6),this.resetPosition("down")):e[t][i].sign=6:3==e[t+1][i].sign&&(e[t][i].sign=0,e[t+1][i].sign=6,e[t+1][i].cover=6,this.resetPosition("down")),0==e[t][i].sign&&e[t][i].cover&&(e[t][i].sign=3,e[t][i].cover=null);var o=setTimeout(function(){n.renderLayout(e),clearTimeout(o)})},moveLeft:function(e){var n=this,i=this.position.x,t=this.position.y;0==e[t][i-1].sign?(e[t][i-1].sign=7,e[t][i].sign=0,this.resetPosition("left")):1==e[t][i-1].sign?e[t][i].sign=7:2==e[t][i-1].sign?0==e[t][i-2].sign?(e[t][i].sign=0,e[t][i-2].sign=2,e[t][i-1].sign=7,e[t][i-1].cover&&(e[t][i-1].cover=7),this.resetPosition("left")):3==e[t][i-2].sign?(e[t][i].sign=0,e[t][i-2].sign=2,e[t][i-2].cover=2,e[t][i-1].sign=7,e[t][i-1].cover&&(e[t][i-1].cover=7),this.resetPosition("left")):e[t][i].sign=7:3==e[t][i-1].sign&&(e[t][i].sign=0,e[t][i-1].sign=7,e[t][i-1].cover=7,this.resetPosition("left")),0==e[t][i].sign&&e[t][i].cover&&2!=e[t][i].cover&&(e[t][i].sign=3,e[t][i].cover=null);var o=setTimeout(function(){n.renderLayout(e),clearTimeout(o)})},moveRight:function(e){var n=this,i=this.position.x,t=this.position.y;0==e[t][i+1].sign?(e[t][i+1].sign=5,e[t][i].sign=0,this.resetPosition("right")):1==e[t][i+1].sign?e[t][i].sign=5:2==e[t][i+1].sign?0==e[t][i+2].sign?(e[t][i].sign=0,e[t][i+2].sign=2,e[t][i+1].sign=5,e[t][i+1].cover&&(e[t][i+1].cover=5),this.resetPosition("right")):3==e[t][i+2].sign?(e[t][i].sign=0,e[t][i+2].sign=2,e[t][i+2].cover=2,e[t][i+1].sign=5,e[t][i+1].cover&&(e[t][i+1].cover=5),this.resetPosition("right")):e[t][i].sign=5:3==e[t][i+1].sign&&(e[t][i].sign=0,e[t][i+1].sign=5,e[t][i+1].cover=5,this.resetPosition("right")),0==e[t][i].sign&&e[t][i].cover&&2!=e[t][i].cover&&(e[t][i].sign=3,e[t][i].cover=null);var o=setTimeout(function(){n.renderLayout(e),clearTimeout(o)})},resetPosition:function(e){switch(e){case"up":this.position.y-=1;break;case"right":this.position.x+=1;break;case"down":this.position.y+=1;break;case"left":this.position.x-=1}this.stepCounterValue++,this.stepCounter.string="\u6b65\u6570\uff1a"+this.stepCounterValue;for(var n=0,i=0;i<window.currentLevel.length;i++)for(var t=0;t<window.currentLevel[0].length;t++)window.currentLevel[i][t].cover&&2==window.currentLevel[i][t].sign&&(n++,this.boxNum==n&&(this.showResult(),clearInterval(this.timeCounterTimer),this.timeCounterTimer=null))},addTouchMove:function(){var e=this,n=null;this.node.on("touchstart",function(e){n=e.getLocation()},this),this.node.on("touchend",function(i){var t=i.getLocation();Math.abs(n.x-t.x)>Math.abs(n.y-t.y)?n.x-t.x<-50?e.moveRight(window.currentLevel):n.x-t.x>50&&e.moveLeft(window.currentLevel):n.y-t.y<-50?e.moveUp(window.currentLevel):n.y-t.y>50&&e.moveDown(window.currentLevel)},this)},showResult:function(){var e=this,n=this.node;if(n){var i=function(i,t){if(i)console.log("Prefab error:"+i);else if(t instanceof cc.Prefab){var o=cc.instantiate(t);cc.find("contentBg/useTime",o).getComponent(cc.Label).string="\u6b65\u6570\uff1a"+e.stepCounterValue+"\u6b65",cc.find("contentBg/useStep",o).getComponent(cc.Label).string="\u7528\u65f6\uff1a"+e.timeCounterValue+"\u79d2",cc.find("contentBg/next",o).on("click",function(){"classicsLevel"==window.levelClassify&&window.levelIndex<window.classicsLevelNum&&(o.removeFromParent(),o.destroy(),e.initPendant(),window.levelIndex++,e.initLevel())},this),cc.find("contentBg/replay",o).on("click",function(){o.removeFromParent(),o.destroy(),e.replayLayout(),e.initPendant()},this),cc.find("contentBg/share",o).on("click",function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){var n="\u76ca\u667a\u63a8\u7bb1";"classicsLevel"==window.levelClassify?n+="-\u7ecf\u5178\u5173\u5361":"netLevel"==window.levelClassify&&(n+="-\u7f51\u53cb\u81ea\u5236\u5173\u5361"),n=n+"\u7b2c"+window.levelIndex+"\u5173-\u4f7f\u7528\u6b65\u6570\uff1a"+e.stepCounterValue+"-\u6311\u6218\u6210\u529f\uff01",wx.shareAppMessage({title:n,query:"\u5206\u4eab"})}},this),n.addChild(o)}else console.log("Prefab error")};setTimeout(function(){cc.loader.loadRes("gameOverAlert",i)},5)}else cc.console("find Canvas error")},replayLayout:function(){var e=this;wx.getStorage({key:"initLevel",success:function(n){window.currentLevel=n.data,e.renderLayout(window.currentLevel),e.initPosition(window.currentLevel)},fail:function(){}})},initPendant:function(){if(null==this.levelCounter){var e=new cc.Node("levelCounter");e.setAnchorPoint(.5,.5),e.width=300,e.height=100;var n=e.addComponent(cc.Label);n.node.setPosition(55,cc.winSize.height/2-.05*cc.winSize.height),n.string="\u7b2c "+window.levelIndex+" \u5173",n.fontSize=60,n.enableBold=!0,n.overflow=cc.Label.Overflow.RESIZE_HEIGHT,n.lineHeight=60,n.horizontalAlign="center",this.levelCounter=e.getComponent(cc.Label),this.node.addChild(e)}else this.levelCounter.string="\u7b2c "+window.levelIndex+" \u5173";if(null==this.stepCounter){var i=new cc.Node("stepCounter");i.setAnchorPoint(0,1);var t=i.addComponent(cc.Label);t.node.setPosition(-cc.winSize.width/2+.05*cc.winSize.width,cc.winSize.width/2+80),t.string="\u6b65\u6570\uff1a 0",this.stepCounter=i.getComponent(cc.Label),this.node.addChild(i)}else this.stepCounterValue=0,this.stepCounter.string="\u6b65\u6570\uff1a"+this.stepCounterValue;if(null==this.timeCounter){var o=new cc.Node("timeCounter");o.setAnchorPoint(0,1);var s=o.addComponent(cc.Label);s.node.setPosition(0,cc.winSize.width/2+80),s.string="\u7528\u65f6\uff1a 0",this.timeCounter=o.getComponent(cc.Label),this.node.addChild(o),this.timeCounterTimer=setInterval(function(){this.timeCounterValue++,this.timeCounter.string="\u7528\u65f6\uff1a"+this.timeCounterValue}.bind(this),1e3)}else this.timeCounterValue=0,this.timeCounter.string="\u7528\u65f6\uff1a"+this.timeCounterValue,null==this.timeCounterTimer&&(this.timeCounterTimer=setInterval(function(){this.timeCounterValue++,this.timeCounter.string="\u7528\u65f6\uff1a"+this.timeCounterValue}.bind(this),1e3))},pendantAddEvent:function(){var e=this;cc.find("back",this.node).on("click",this.back,this),cc.find("gameBtns/up",this.node).on("click",function(){e.moveUp(window.currentLevel)},this),cc.find("gameBtns/right",this.node).on("click",function(){e.moveRight(window.currentLevel)},this),cc.find("gameBtns/down",this.node).on("click",function(){e.moveDown(window.currentLevel)},this),cc.find("gameBtns/left",this.node).on("click",function(){e.moveLeft(window.currentLevel)},this),cc.find("gameBtns/menu",this.node).on("click",function(){clearInterval(e.timeCounterTimer),e.timeCounterTimer=null;var n=e.node;n?cc.loader.loadRes("gameMenu",function(i,t){if(i)console.log("Prefab error:"+i);else if(t instanceof cc.Prefab){var o=cc.instantiate(t);cc.find("contain/continue",o).on("click",function(){null==e.timeCounterTimer&&(e.timeCounterTimer=setInterval(function(){e.timeCounterValue++,e.timeCounter.string="\u7528\u65f6\uff1a"+e.timeCounterValue}.bind(e),1e3)),o.removeFromParent(),o.destroy()},this),cc.find("contain/replay",o).on("click",function(){o.removeFromParent(),o.destroy(),e.replayLayout(),e.initPendant()},this),cc.find("contain/share",o).on("click",function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){var e="\u76ca\u667a\u63a8\u7bb1";"classicsLevel"==window.levelClassify?e+="-\u7ecf\u5178\u5173\u5361":"netLevel"==window.levelClassify&&(e+="-\u7f51\u53cb\u81ea\u5236\u5173\u5361"),e=e+"\u7b2c"+window.levelIndex+"\u5173-\u5feb\u6765\u6311\u6218\u5427!",wx.shareAppMessage({title:e,query:"\u5206\u4eab"})}},this),n.addChild(o)}else console.log("Prefab error")}):cc.console("find Canvas error")},this)},initLevel:function(){var e=this;cc.sys.platform===cc.sys.WECHAT_GAME&&"classicsLevel"==window.levelClassify&&wx.cloud.callFunction({name:"queryClassicsLevel",data:{levelIndex:window.levelIndex}}).then(function(n){n&&n.result.data.length>0&&(window.currentLevel=n.result.data[0].content,e.renderLayout(window.currentLevel),e.initPosition(window.currentLevel),e.initPendant(),wx.setStorage({key:"initLevel",data:window.currentLevel}))}).catch(function(e){console.error(e)})},back:function(){this.initPendant(),clearInterval(this.timeCounterTimer),this.timeCounterTimer=null,cc.director.loadScene("main")}}),cc._RF.pop()},{"./level":"level"}],levelItem:[function(e,n){"use strict";cc._RF.push(n,"2cfd6DcvT5OTYgzh6qWc2QW","levelItem"),cc.Class({extends:cc.Component,properties:{levelNum:null,levelLock:null},start:function(){},init:function(){this.levelNum=cc.find("levelNum",this.node).getComponent(cc.Label),this.levelNum.string="1",this.levelLock=cc.find("levelLock",this.node),this.levelLock.opacity=0}}),cc._RF.pop()},{}],levelLayout:[function(e,n){"use strict";cc._RF.push(n,"fef7dUI0+VDDZg/zyXQW1yR","levelLayout"),cc.Class({extends:cc.Component,properties:{levelItem:cc.Prefab,levelList:null,levelListConten:null,levelSrollView:null,classicsLevelBtn:cc.Button,netLevelBtn:cc.Button,closeLevelBtn:cc.Button},onLoad:function(){},start:function(){this.levelList=cc.find("levelList/levelScrollView/view/content/itemList",this.node),this.levelListConten=cc.find("levelList/levelScrollView/view/content",this.node),this.levelSrollView=cc.find("levelList/levelScrollView",this.node),null==this.classicsLevelBtn&&(this.classicsLevelBtn=cc.find("levelList/classify/classicsLevel",this.node).getComponent(cc.Button)),null==this.netLevelBtn&&(this.netLevelBtn=cc.find("levelList/classify/netLevel",this.node).getComponent(cc.Button)),null==this.closeLevelBtn&&(this.closeLevelBtn=cc.find("closeLevel",this.node).getComponent(cc.Button)),this.classicsLevelBtn.node.on("click",this.loadClassicsLevelList,this),this.netLevelBtn.node.on("click",this.loadNetLevelList,this),this.closeLevelBtn.node.on("click",this.closeLevelLayout,this),this.loadClassicsLevelList()},loadClassicsLevelList:function(){var e=this;cc.find("Background/Label",this.classicsLevelBtn.node).color=cc.color(202,122,0);var n=cc.find("Background/Label",this.netLevelBtn.node);n.color=cc.color(255,255,255),n.opacity=125,window.levelClassify="classicsLevel",this.levelList.destroyAllChildren();for(var i=0,t=10,o=window.classicsLevelNum,s=function(n){var s=cc.instantiate(e.levelItem),c=n+1;1==c&&(s.getChildByName("levelNum").getComponent(cc.Label).string=c,s.getChildByName("levelLock").opacity=0),e.levelList.addChild(s),s.on("touchend",function(){window.levelIndex=c,cc.director.loadScene("game")},e),c<=t&&(t=Math.floor(o/Math.floor(e.levelListConten.width/s.width)-1),i+=s.height+70)},c=0;c<o;c++)s(c);this.levelListConten.height=i},loadNetLevelList:function(){var e=this,n=cc.find("Background/Label",this.classicsLevelBtn.node);n.color=cc.color(255,255,255),n.opacity=125,cc.find("Background/Label",this.netLevelBtn.node).color=cc.color(202,122,0),window.levelClassify="netLevel",this.levelList.destroyAllChildren();for(var i=0,t=10,o=window.netLevelNum,s=function(n){var s=cc.instantiate(e.levelItem),c=n+1;c<=window.userInfo.classicsLevelNum&&(s.getChildByName("levelNum").getComponent(cc.Label).string=c,s.getChildByName("levelLock").opacity=0),e.levelList.addChild(s),s.on("touchend",function(){cc.log("level:"+c)},e),c<=t&&(t=Math.floor(o/Math.floor(e.levelListConten.width/s.width)-1),i+=s.height+70)},c=0;c<o;c++)s(c);this.levelListConten.height=i},closeLevelLayout:function(){this.node.removeFromParent(),this.node.destroy()}}),cc._RF.pop()},{}],level:[function(e,n,i){"use strict";cc._RF.push(n,"8303276hNVKza2rc2TmzBRT","level"),i.__esModule=!0,i.default=void 0;for(var t=new Array,o=new Array,s=new Array,c=0;c<12;c++){o[c]=new Array,s[c]=new Array;for(var l=0;l<12;l++)o[c][l]={sign:0},s[c][l]={sign:0}}o[1][3].sign=1,o[1][4].sign=1,o[1][5].sign=1,o[2][3].sign=1,o[2][4].sign=3,o[2][5].sign=1,o[3][3].sign=1,o[3][4].sign=0,o[3][5].sign=1,o[3][6].sign=1,o[3][7].sign=1,o[3][8].sign=1,o[4][1].sign=1,o[4][2].sign=1,o[4][3].sign=1,o[4][4].sign=2,o[4][5].sign=0,o[4][6].sign=2,o[4][7].sign=3,o[4][8].sign=1,o[5][1].sign=1,o[5][2].sign=3,o[5][3].sign=0,o[5][4].sign=2,o[5][5].sign=6,o[5][6].sign=1,o[5][7].sign=1,o[5][8].sign=1,o[6][1].sign=1,o[6][2].sign=1,o[6][3].sign=1,o[6][4].sign=1,o[6][5].sign=2,o[6][6].sign=1,o[7][4].sign=1,o[7][5].sign=3,o[7][6].sign=1,o[8][4].sign=1,o[8][5].sign=1,o[8][6].sign=1,s[1][1].sign=1,s[1][2].sign=1,s[1][3].sign=1,s[1][4].sign=1,s[1][5].sign=1,s[2][1].sign=1,s[2][2].sign=6,s[2][5].sign=1,s[3][1].sign=1,s[3][3].sign=2,s[3][4].sign=2,s[3][5].sign=1,s[3][7].sign=1,s[3][8].sign=1,s[3][9].sign=1,s[4][1].sign=1,s[4][3].sign=2,s[4][5].sign=1,s[4][7].sign=1,s[4][8].sign=3,s[4][9].sign=1,s[5][1].sign=1,s[5][2].sign=1,s[5][3].sign=1,s[5][5].sign=1,s[5][6].sign=1,s[5][7].sign=1,s[5][8].sign=3,s[5][9].sign=1,s[6][2].sign=1,s[6][3].sign=1,s[6][8].sign=3,s[6][9].sign=1,s[7][2].sign=1,s[7][6].sign=1,s[7][9].sign=1,s[8][2].sign=1,s[8][6].sign=1,s[8][7].sign=1,s[8][8].sign=1,s[8][9].sign=1,s[9][2].sign=1,s[9][3].sign=1,s[9][4].sign=1,s[9][5].sign=1,s[9][6].sign=1,t.push(o,s);var r=t;i.default=r,n.exports=i.default,cc._RF.pop()},{}],main:[function(e,n){"use strict";var i;cc._RF.push(n,"2276c+jCHZBGYX+JxzXyKDF","main"),(i=e("./level"))&&i.__esModule,window.env="cloud1-5gvbuiy3dd99f63c",cc.sys.platform===cc.sys.WECHAT_GAME&&wx.cloud.init({env:window.env}),window.userInfo={},window.classicsLevelNum=0,window.netLevelNum=0,window.levelIndex=0,window.bgUrlBase="",cc.Class({extends:cc.Component,properties:{oneSayLabel:{default:null,type:cc.Label},loginplay:cc.Button,visitorplay:cc.Button,levelLayout:cc.Prefab},onLoad:function(){null==this.loginplay&&(this.loginplay=cc.find("Canvas/mainBg/loginplay").getComponent(cc.Button)),this.loginplay.node.on("click",this.loginLevelList,this),null==this.visitorplay&&(this.visitorplay=cc.find("Canvas/mainBg/visitorplay").getComponent(cc.Button)),this.visitorplay.node.on("click",this.visitorLevelList,this)},start:function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.cloud.callFunction({name:"getClassicsLevelNum"}).then(function(e){window.classicsLevelNum=e.result.total}).catch(function(e){console.error(e)}),this.getUserInfo()},loadImg:function(){var e=cc.find("Canvas/mainBg/bingBg"),n="",i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&i.status>=200&&i.status<400){var t=JSON.parse(i.responseText);n="https://cn.bing.com"+t.images[0].urlbase+"_720x1280.jpg",window.bgUrlBase="https://cn.bing.com"+t.images[0].urlbase,cc.assetManager.loadRemote(n,function(n,i){var t=new cc.SpriteFrame(i);e.spriteFrame=t;var o=new cc.Node;o.name="star1",o.setPosition(0,0);var s=o.addComponent(cc.Sprite);s.spriteFrame=t,s.sizeMode="CUSTOM",s.node.width=cc.winSize.width,s.node.height=cc.winSize.height,e.addChild(o)})}},i.open("get","https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1",!0),i.send()},oneSay:function(){var e=this,n=new XMLHttpRequest,i=cc.find("Canvas/mainBg/oneSay").getComponent(cc.Component);n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){var t=JSON.parse(n.responseText);e.oneSayLabel&&null!=e.oneSayLabel.string?e.oneSayLabel.string=t.hitokoto+" -- "+t.from:i&&null!=i.string&&(i.string=t.hitokoto+" -- "+t.from)}},n.open("get","https://v1.hitokoto.cn/",!0),n.send()},loginLevelList:function(){window.loginType="wechat";var e=cc.find("Canvas");e?cc.loader.loadRes("levelLayout",function(n,i){if(n)console.log("Prefab error:"+n);else if(i instanceof cc.Prefab){var t=cc.instantiate(i);e.addChild(t)}else console.log("Prefab error")}):cc.console("find Canvas error")},visitorLevelList:function(){window.loginType="visitor";var e=cc.find("Canvas");e?cc.loader.loadRes("levelLayout",function(n,i){if(n)console.log("Prefab error:"+n);else if(i instanceof cc.Prefab){var t=cc.instantiate(i);e.addChild(t)}else console.log("Prefab error")}):cc.console("find Canvas error")},getUserInfo:function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.getStorage({key:"appId",success:function(e){window.userInfo.appId=e.data,wx.cloud.callFunction({name:"queryUser",data:{appId:window.userInfo.appId}}).then(function(e){e&&e.result.data.length>0&&(window.userInfo.classicsLevelNum=e.result.data[0].classicsLevelNum,window.userInfo.netLevelNum=e.result.data[0].netLevelNum)}).catch(function(e){console.error(e)})},fail:function(){wx.cloud.callFunction({name:"login"}).then(function(e){e&&e.result&&(wx.setStorage({key:"appId",data:e.result.appid}),wx.setStorage({key:"openId",data:e.result.openid}),window.userInfo.appId=e.result.appid,window.userInfo.classicsLevelNum=0,window.userInfo.netLevelNum=0,wx.cloud.callFunction({name:"addUser",data:{appId:e.result.appid,openId:e.result.openid}}).then(function(e){console.log(e)}).catch(function(e){console.error(e)}))}).catch(function(e){console.error(e)})}})},login:function(e,n){if(cc.sys.platform!==cc.sys.WECHAT_GAME);else{var i=window.wx,t=systemInfo=i.getSystemInfoSync(),o=screenWidth=t.screenWidth,s=screenHeight=t.screenHeight;i.getSetting({success:function(t){if(console.log(t.authSetting),t.authSetting["scope.userInfo"])console.log("\u7528\u6237\u5df2\u6388\u6743"),i.getUserInfo({success:function(n){userInfo=n.userInfo,e&&e(n.userInfo)}});else{console.log("\u7528\u6237\u672a\u6388\u6743");var c=i.createUserInfoButton({type:"text",text:"",style:{left:0,top:0,width:o,height:s,backgroundColor:"#00000000",color:"#ffffff",fontSize:20,textAlign:"center",lineHeight:s}});c.onTap(function(i){i.userInfo?(console.log("\u7528\u6237\u6388\u6743:",i.userInfo),userInfo=i.userInfo,e&&e(i.userInfo),c.destroy()):(console.log("\u7528\u6237\u62d2\u7edd\u6388\u6743:"),n&&n())})}}})}}}),cc._RF.pop()},{"./level":"level"}]},{},["common","eleSize","gameLayout","level","levelItem","levelLayout","main"]);