window.__require=function e(n,i,o){function t(s,l){if(!i[s]){if(!n[s]){var a=s.split("/");if(a=a[a.length-1],!n[a]){var r="function"==typeof __require&&__require;if(!l&&r)return r(a,!0);if(c)return c(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var d=i[s]={exports:{}};n[s][0].call(d.exports,function(e){return t(n[s][1][e]||e)},d,d.exports,e,n,i,o)}return i[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<o.length;s++)t(o[s]);return t}({build:[function(e,n){"use strict";cc._RF.push(n,"e870b8Vuf9L7IAU2PwLTbJH","build");var i=e("./common");window.eleSize=35,window.layout=new Array,window.blockNum=12,cc.Class({extends:cc.Component,properties:{block:{default:null,type:cc.Prefab,displayName:"block"},wall:{default:null,type:cc.Prefab,displayName:"wall"},box:{default:null,type:cc.Prefab,displayName:"box"},ball:{default:null,type:cc.Prefab,displayName:"ball"},roleUp:{default:null,type:cc.Prefab,displayName:"roleUp"},roleRight:{default:null,type:cc.Prefab,displayName:"roleRight"},roleDown:{default:null,type:cc.Prefab,displayName:"roleDown"},roleLeft:{default:null,type:cc.Prefab,displayName:"roleLeft"},position:{default:null},gameBn:cc.Sprite,boxNum:{default:null},selectEle:1,wallEle:cc.Prefab,boxEle:cc.Prefab,ballEle:cc.Prefab,upEle:cc.Prefab,rightEle:cc.Prefab,downEle:cc.Prefab,leftEle:cc.Prefab},onLoad:function(){var e=this;this.initWinEle(),this.renderBg(),"game"==window.from&&wx.getStorage({key:"buildLevel",success:function(n){window.buildLevel=n.data,e.renderLayout(window.buildLevel)}}),cc.find("btns",this.node).height=(cc.winSize.height-cc.winSize.width)/2},start:function(){this.addEvent(),this.renderSelectEle()},initWinEle:function(){var e=cc.winSize.width/window.blockNum;window.eleSize=e;for(var n=0;n<window.blockNum;n++){window.layout[n]=new Array,window.buildLevel[n]=new Array;for(var i=0;i<window.blockNum;i++)window.layout[n][i]={x:0,y:0,sign:0,cover:null},window.buildLevel[n][i]={x:0,y:0,sign:0,cover:null}}},initPosition:function(e){this.position={},this.boxNum=0;for(var n=0;n<e.length;n++)for(var i=0;i<e[0].length;i++)4!=e[n][i].sign&&5!=e[n][i].sign&&6!=e[n][i].sign&&7!=e[n][i].sign||(this.position.x=i,this.position.y=n),2==e[n][i].sign&&this.boxNum++},renderBg:function(){for(var e=-cc.winSize.width/2,n=window.eleSize*window.blockNum/2,i=0;i<window.blockNum;i++)for(var o=0;o<window.blockNum;o++){var t=o*window.eleSize+e,c=-i*window.eleSize+n;window.layout[i][o]={x:t,y:c,sign:0,cover:null};var s=cc.instantiate(this.block);s.setPosition(t,c),this.node.addChild(s)}},renderBn:function(){var e=this;null==this.gameBn&&(this.gameBn=cc.find("Canvas/buildBg/gameBn").getComponent(cc.Sprite)),cc.assetManager.loadRemote(window.bgUrlBase+"_400x240.jpg",function(n,i){var o=new cc.SpriteFrame(i,cc.rect(0,0,400,240));e.gameBn.spriteFrame=o})},addEvent:function(){var e=this;null==this.wallEle&&(this.wallEle=cc.find("btns/wallWrap",this.node)),null==this.boxEle&&(this.boxEle=cc.find("btns/boxWrap",this.node)),null==this.ballEle&&(this.ballEle=cc.find("btns/ballWrap",this.node)),null==this.upEle&&(this.upEle=cc.find("btns/upWrap",this.node)),null==this.rightEle&&(this.rightEle=cc.find("btns/rightWrap",this.node)),null==this.downEle&&(this.downEle=cc.find("btns/downWrap",this.node)),null==this.leftEle&&(this.leftEle=cc.find("btns/leftWrap",this.node)),cc.find("back",this.node).on("click",this.back,this),cc.find("btns/clear",this.node).on("click",function(){e.initWinEle(),e.renderBg()},this),cc.find("btns/play",this.node).on("click",function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){for(var e=0,n=0,o=0,t=0;t<window.blockNum;t++)for(var c=0;c<window.blockNum;c++)if(2==window.buildLevel[t][c].sign&&e++,3!=window.buildLevel[t][c].sign&&null==window.buildLevel[t][c].cover||n++,window.buildLevel[t][c].sign>=4&&o++,t==window.blockNum-1&&c==window.blockNum-1){if(o<=0)return void(0,i.Toast)("\u672a\u6dfb\u52a0\u4eba\u7269",1500);if(e!=n)return void(0,i.Toast)("\u7bb1\u5b50\u548c\u7403\u4f53\u6570\u91cf\u4e0d\u4e00\u81f4",1500);if(e<3)return void(0,i.Toast)("\u7bb1\u5b50\u6570\u91cf\u4e0d\u80fd\u5c11\u4e8e\u4e09\u4e2a",1500)}wx.setStorage({key:"buildLevel",data:window.buildLevel,success:function(){window.from="build",cc.director.loadScene("game")}})}},this),this.node.on("touchend",function(n){for(var i=n.getLocation(),o=cc.find("Canvas").convertToNodeSpaceAR(i),t=0;t<window.blockNum;t++)for(var c=0;c<window.blockNum;c++)window.layout[0][0].x<=o.x&&o.x<=window.layout[0][window.blockNum-1].x+window.eleSize&&window.layout[0][0].y>=o.y&&o.y>=window.layout[window.blockNum-1][window.blockNum-1].y-window.eleSize&&e.selectEle>=4&&window.buildLevel[t][c].sign>=4&&(window.buildLevel[t][c].sign=0,window.buildLevel[t][c].cover=null),window.layout[t][c].x<=o.x&&o.x<=window.layout[t][c].x+window.eleSize&&window.layout[t][c].y>=o.y&&o.y>=window.layout[t][c].y-window.eleSize&&(window.buildLevel[t][c].sign&&0!=window.buildLevel[t][c].sign?3==window.buildLevel[t][c].sign&&null==window.buildLevel[t][c].cover&&1!=e.selectEle&&3!=e.selectEle?(window.buildLevel[t][c].sign=e.selectEle,window.buildLevel[t][c].cover=e.selectEle):(window.buildLevel[t][c].sign=0,window.buildLevel[t][c].cover=null):window.buildLevel[t][c].sign=e.selectEle);e.renderLayout(window.buildLevel),e.wallEle.getBoundingBoxToWorld().x<=i.x&&i.x<=e.wallEle.getBoundingBoxToWorld().x+e.wallEle.getBoundingBoxToWorld().width&&e.wallEle.getBoundingBoxToWorld().y<=i.y&&i.y<=e.wallEle.getBoundingBoxToWorld().y+e.wallEle.getBoundingBoxToWorld().height?(e.selectEle=1,e.renderSelectEle()):e.boxEle.getBoundingBoxToWorld().x<=i.x&&i.x<=e.boxEle.getBoundingBoxToWorld().x+e.boxEle.getBoundingBoxToWorld().width&&e.boxEle.getBoundingBoxToWorld().y<=i.y&&i.y<=e.boxEle.getBoundingBoxToWorld().y+e.boxEle.getBoundingBoxToWorld().height?(e.selectEle=2,e.renderSelectEle()):e.ballEle.getBoundingBoxToWorld().x<=i.x&&i.x<=e.ballEle.getBoundingBoxToWorld().x+e.ballEle.getBoundingBoxToWorld().width&&e.ballEle.getBoundingBoxToWorld().y<=i.y&&i.y<=e.ballEle.getBoundingBoxToWorld().y+e.ballEle.getBoundingBoxToWorld().height?(e.selectEle=3,e.renderSelectEle()):e.upEle.getBoundingBoxToWorld().x<=i.x&&i.x<=e.upEle.getBoundingBoxToWorld().x+e.upEle.getBoundingBoxToWorld().width&&e.upEle.getBoundingBoxToWorld().y<=i.y&&i.y<=e.upEle.getBoundingBoxToWorld().y+e.upEle.getBoundingBoxToWorld().height?(e.selectEle=4,e.renderSelectEle()):e.rightEle.getBoundingBoxToWorld().x<=i.x&&i.x<=e.rightEle.getBoundingBoxToWorld().x+e.rightEle.getBoundingBoxToWorld().width&&e.rightEle.getBoundingBoxToWorld().y<=i.y&&i.y<=e.rightEle.getBoundingBoxToWorld().y+e.rightEle.getBoundingBoxToWorld().height?(e.selectEle=5,e.renderSelectEle()):e.downEle.getBoundingBoxToWorld().x<=i.x&&i.x<=e.downEle.getBoundingBoxToWorld().x+e.downEle.getBoundingBoxToWorld().width&&e.downEle.getBoundingBoxToWorld().y<=i.y&&i.y<=e.downEle.getBoundingBoxToWorld().y+e.downEle.getBoundingBoxToWorld().height?(e.selectEle=6,e.renderSelectEle()):e.leftEle.getBoundingBoxToWorld().x<=i.x&&i.x<=e.leftEle.getBoundingBoxToWorld().x+e.leftEle.getBoundingBoxToWorld().width&&e.leftEle.getBoundingBoxToWorld().y<=i.y&&i.y<=e.leftEle.getBoundingBoxToWorld().y+e.leftEle.getBoundingBoxToWorld().height&&(e.selectEle=7,e.renderSelectEle())},this)},renderSelectEle:function(){switch(this.wallEle.color=(new cc.Color).fromHEX("#95D52F"),this.boxEle.color=(new cc.Color).fromHEX("#95D52F"),this.ballEle.color=(new cc.Color).fromHEX("#95D52F"),this.upEle.color=(new cc.Color).fromHEX("#95D52F"),this.rightEle.color=(new cc.Color).fromHEX("#95D52F"),this.downEle.color=(new cc.Color).fromHEX("#95D52F"),this.leftEle.color=(new cc.Color).fromHEX("#95D52F"),this.selectEle){case 1:this.wallEle.color=(new cc.Color).fromHEX("#FFFFFF");break;case 2:this.boxEle.color=(new cc.Color).fromHEX("#FFFFFF");break;case 3:this.ballEle.color=(new cc.Color).fromHEX("#FFFFFF");break;case 4:this.upEle.color=(new cc.Color).fromHEX("#FFFFFF");break;case 5:this.rightEle.color=(new cc.Color).fromHEX("#FFFFFF");break;case 6:this.downEle.color=(new cc.Color).fromHEX("#FFFFFF");break;case 7:this.leftEle.color=(new cc.Color).fromHEX("#FFFFFF")}},back:function(){window.from="build",cc.director.loadScene("main")},renderLayout:function(e){this.renderBg();for(var n=0;n<window.blockNum;n++)for(var i=0;i<window.blockNum;i++){var o=window.layout[n][i].x,t=window.layout[n][i].y;switch(e[n][i].sign){case 0:var c=cc.instantiate(this.block);c.setPosition(o,t),this.node.addChild(c);break;case 1:var s=cc.instantiate(this.wall);s.setPosition(o,t),this.node.addChild(s);break;case 2:var l=cc.instantiate(this.box);l.setPosition(o,t),this.node.addChild(l);break;case 3:var a=cc.instantiate(this.ball);a.setPosition(o,t),this.node.addChild(a);break;case 4:var r=cc.instantiate(this.roleUp);r.setPosition(o,t),this.node.addChild(r);break;case 5:var d=cc.instantiate(this.roleRight);d.setPosition(o,t),this.node.addChild(d);break;case 6:var u=cc.instantiate(this.roleDown);u.setPosition(o,t),this.node.addChild(u);break;case 7:var w=cc.instantiate(this.roleLeft);w.setPosition(o,t),this.node.addChild(w)}}},onDestroy:function(){}}),cc._RF.pop()},{"./common":"common"}],common:[function(e,n,i){"use strict";cc._RF.push(n,"db8b31XBphC44pnJIdLHrEO","common"),i.__esModule=!0,i.wxLogin=function(e,n,i){if(cc.sys.platform===cc.sys.WECHAT_GAME){var o=window.wx,t=o.getSystemInfoSync(),c=t.screenWidth,s=t.screenHeight,l=2*i.width/1080*c,a=2*i.height/2400*s,r=c/2-l/2,d=s/2-a/2-i.y/2400*s+i.y/2400*s*.25;o.getSetting({success:function(i){if(i.authSetting["scope.userInfo"])return o.getUserInfo({success:function(n){e&&e(n.userInfo)}}),!1;var t=o.createUserInfoButton({type:"text",text:"",style:{left:parseInt(r),top:parseInt(d),width:parseInt(l),height:parseInt(a),backgroundColor:"#00000000",color:"#ffffff",fontSize:20,textAlign:"center",lineHeight:parseInt(a)}});t.onTap(function(i){i.userInfo?(e&&e(i.userInfo),t.destroy()):n&&n()}),window.wxLoginBtn=t}})}},i.Toast=function(e,n){var i=cc.find("Canvas");if(i){var o=window.wx.getSystemInfoSync();o.screenWidth,o.screenHeight,cc.loader.loadRes("toast",function(o,t){if(o)console.log("Prefab error:"+o);else if(t instanceof cc.Prefab){var c=cc.instantiate(t),s=cc.find("background",c).getComponent(cc.Graphics),l=cc.find("text",c);l.getComponent(cc.Label).string=e,i.addChild(c),s.roundRect(-(l.width+80)/2,-(l.height+40)/2,l.width+80,l.height+40,(l.height+40)/2),s.fillColor=cc.Color.BLACK,s.fill();var a=setTimeout(function(){c.removeFromParent(),c.destroy(),clearTimeout(a),a=null},n)}else console.log("Prefab error")})}else cc.console("find Canvas error")},i.formateRankTime=function(e){var n=new Date(e),i=n.getFullYear()+"-",o=(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)+"-",t=n.getDate()+"\n",c=n.getHours()+":",s=n.getMinutes()+":",l=n.getSeconds();return c.length<=1&&(c="0"+c),s.length<=1&&(s="0"+s),l.length<=1&&(l="0"+l),i+o+t+c+s+l},i.Loading=void 0;var o={ele:null,hideFlage:!1,show:function(){o.hideFlage=!1;var e=cc.find("Canvas");e?cc.loader.loadRes("loading",function(n,i){if(n)console.log("Prefab error:"+n);else if(i instanceof cc.Prefab){var t=cc.instantiate(i);o.hideFlage?t.destroy():(e.addChild(t),o.ele=t)}else console.log("Prefab error")}):cc.console("find Canvas error")},hide:function(){o.ele&&(o.ele.removeFromParent(),o.ele.destroy(),o.ele=null),o.hideFlage=!0}};i.Loading=o,cc._RF.pop()},{}],eleSize:[function(e,n){"use strict";cc._RF.push(n,"492ddrnQNVDwqTjOokjYqHi","eleSize"),cc.Class({extends:cc.Component,properties:{},start:function(){this.node.width=this.node.height=window.eleSize}}),cc._RF.pop()},{}],gameLayout:[function(e,n){"use strict";cc._RF.push(n,"8bc72A5qvpI1ZnhM9AbJxE6","gameLayout");var i=e("./common");window.currentLevel=[],window.eleSize=35,window.layout=new Array,window.blockNum=12,window.uploadLevel=null,cc.Class({extends:cc.Component,properties:{block:{default:null,type:cc.Prefab,displayName:"block"},wall:{default:null,type:cc.Prefab,displayName:"wall"},box:{default:null,type:cc.Prefab,displayName:"box"},ball:{default:null,type:cc.Prefab,displayName:"ball"},roleUp:{default:null,type:cc.Prefab,displayName:"roleUp"},roleRight:{default:null,type:cc.Prefab,displayName:"roleRight"},roleDown:{default:null,type:cc.Prefab,displayName:"roleDown"},roleLeft:{default:null,type:cc.Prefab,displayName:"roleLeft"},position:{default:null},gameBn:cc.Sprite,boxNum:{default:null},stepCounter:null,stepCounterValue:0,timeCounter:null,timeCounterValue:0,timeCounterTimer:null,levelCounter:null,moveHistoryList:[],lastScore:null,lastStepNode:null,lastTimenode:null,rankItem:cc.Prefab,buildArea:null,solutionBtn:null,noneSkipChange:!1,solutionStepIndex:-1,recordSolutionStep:[]},onLoad:function(){this.initWinEle(),this.renderBg(),this.initLevel(),cc.find("gameBtns",this.node).height=(cc.winSize.height-cc.winSize.width)/2},start:function(){this.addTouchMove(),this.pendantAddEvent()},initWinEle:function(){this.buildArea=cc.find("Canvas/mainBg/buildArea");var e=cc.winSize.width/window.blockNum;window.eleSize=e;for(var n=0;n<window.blockNum;n++){window.layout[n]=new Array;for(var i=0;i<window.blockNum;i++)window.layout[n][i]={x:0,y:0,sign:0,cover:null}}},initPosition:function(e){this.position={},this.boxNum=0;for(var n=0;n<e.length;n++)for(var i=0;i<e[0].length;i++)4!=e[n][i].sign&&5!=e[n][i].sign&&6!=e[n][i].sign&&7!=e[n][i].sign||(this.position.x=i,this.position.y=n),2==e[n][i].sign&&this.boxNum++},renderBg:function(){for(var e=-cc.winSize.width/2,n=window.eleSize*window.blockNum/2,i=0;i<window.blockNum;i++)for(var o=0;o<window.blockNum;o++){var t=o*window.eleSize+e,c=-i*window.eleSize+n;window.layout[i][o]={x:t,y:c,sign:0,cover:null};var s=cc.instantiate(this.block);s.setPosition(t,c),this.buildArea.addChild(s)}},renderBn:function(){null==this.gameBn&&(this.gameBn=cc.find("Canvas/mainBg/gameBn").getComponent(cc.Sprite)),cc.assetManager.loadRemote(window.bgUrlBase+"_400x240.jpg",function(e,n){var i=new cc.SpriteFrame(n,cc.rect(0,0,400,240));that.gameBn.spriteFrame=i})},renderLayout:function(e){this.buildArea.destroyAllChildren(),this.renderBg();for(var n=0;n<window.blockNum;n++)for(var i=0;i<window.blockNum;i++){var o=window.layout[n][i].x,t=window.layout[n][i].y;switch(e[n][i].sign){case 0:var c=cc.instantiate(this.block);c.setPosition(o,t),this.buildArea.addChild(c);break;case 1:var s=cc.instantiate(this.wall);s.setPosition(o,t),this.buildArea.addChild(s);break;case 2:var l=cc.instantiate(this.box);l.setPosition(o,t),this.buildArea.addChild(l);break;case 3:var a=cc.instantiate(this.ball);a.setPosition(o,t),this.buildArea.addChild(a);break;case 4:var r=cc.instantiate(this.roleUp);r.setPosition(o,t),this.buildArea.addChild(r);break;case 5:var d=cc.instantiate(this.roleRight);d.setPosition(o,t),this.buildArea.addChild(d);break;case 6:var u=cc.instantiate(this.roleDown);u.setPosition(o,t),this.buildArea.addChild(u);break;case 7:var w=cc.instantiate(this.roleLeft);w.setPosition(o,t),this.buildArea.addChild(w)}}},moveUp:function(e){var n=this.position.x,i=this.position.y;0==e[i-1][n].sign?(e[i-1][n].sign=4,e[i][n].sign=0,this.resetPosition("up")):1==e[i-1][n].sign?e[i][n].sign=4:2==e[i-1][n].sign?0==e[i-2][n].sign?(e[i][n].sign=0,e[i-2][n].sign=2,e[i-1][n].sign=4,e[i-1][n].cover&&(e[i-1][n].cover=4),this.resetPosition("up")):3==e[i-2][n].sign?(e[i][n].sign=0,e[i-2][n].sign=2,e[i-2][n].cover=2,e[i-1][n].sign=4,e[i-1][n].cover&&(e[i-1][n].cover=4),this.resetPosition("up")):e[i][n].sign=4:3==e[i-1][n].sign&&(e[i][n].sign=0,e[i-1][n].sign=4,e[i-1][n].cover=4,this.resetPosition("up")),0==e[i][n].sign&&e[i][n].cover&&(e[i][n].sign=3,e[i][n].cover=null),this.renderLayout(e)},moveDown:function(e){var n=this.position.x,i=this.position.y;0==e[i+1][n].sign?(e[i+1][n].sign=6,e[i][n].sign=0,this.resetPosition("down")):1==e[i+1][n].sign?e[i][n].sign=6:2==e[i+1][n].sign?0==e[i+2][n].sign?(e[i][n].sign=0,e[i+2][n].sign=2,e[i+1][n].sign=6,e[i+1][n].cover&&(e[i+1][n].cover=6),this.resetPosition("down")):3==e[i+2][n].sign?(e[i][n].sign=0,e[i+2][n].sign=2,e[i+2][n].cover=2,e[i+1][n].sign=6,e[i+1][n].cover&&(e[i+1][n].cover=6),this.resetPosition("down")):e[i][n].sign=6:3==e[i+1][n].sign&&(e[i][n].sign=0,e[i+1][n].sign=6,e[i+1][n].cover=6,this.resetPosition("down")),0==e[i][n].sign&&e[i][n].cover&&(e[i][n].sign=3,e[i][n].cover=null),this.renderLayout(e)},moveLeft:function(e){var n=this.position.x,i=this.position.y;0==e[i][n-1].sign?(e[i][n-1].sign=7,e[i][n].sign=0,this.resetPosition("left")):1==e[i][n-1].sign?e[i][n].sign=7:2==e[i][n-1].sign?0==e[i][n-2].sign?(e[i][n].sign=0,e[i][n-2].sign=2,e[i][n-1].sign=7,e[i][n-1].cover&&(e[i][n-1].cover=7),this.resetPosition("left")):3==e[i][n-2].sign?(e[i][n].sign=0,e[i][n-2].sign=2,e[i][n-2].cover=2,e[i][n-1].sign=7,e[i][n-1].cover&&(e[i][n-1].cover=7),this.resetPosition("left")):e[i][n].sign=7:3==e[i][n-1].sign&&(e[i][n].sign=0,e[i][n-1].sign=7,e[i][n-1].cover=7,this.resetPosition("left")),0==e[i][n].sign&&e[i][n].cover&&2!=e[i][n].cover&&(e[i][n].sign=3,e[i][n].cover=null),this.renderLayout(e)},moveRight:function(e){var n=this.position.x,i=this.position.y;0==e[i][n+1].sign?(e[i][n+1].sign=5,e[i][n].sign=0,this.resetPosition("right")):1==e[i][n+1].sign?e[i][n].sign=5:2==e[i][n+1].sign?0==e[i][n+2].sign?(e[i][n].sign=0,e[i][n+2].sign=2,e[i][n+1].sign=5,e[i][n+1].cover&&(e[i][n+1].cover=5),this.resetPosition("right")):3==e[i][n+2].sign?(e[i][n].sign=0,e[i][n+2].sign=2,e[i][n+2].cover=2,e[i][n+1].sign=5,e[i][n+1].cover&&(e[i][n+1].cover=5),this.resetPosition("right")):e[i][n].sign=5:3==e[i][n+1].sign&&(e[i][n].sign=0,e[i][n+1].sign=5,e[i][n+1].cover=5,this.resetPosition("right")),0==e[i][n].sign&&e[i][n].cover&&2!=e[i][n].cover&&(e[i][n].sign=3,e[i][n].cover=null),this.renderLayout(e)},resetPosition:function(e){var n=this;switch(e){case"up":this.position.y-=1,"uploadSolution"==window.from&&n.recordSolutionStep.push("U");break;case"right":this.position.x+=1,"uploadSolution"==window.from&&n.recordSolutionStep.push("R");break;case"down":this.position.y+=1,"uploadSolution"==window.from&&n.recordSolutionStep.push("D");break;case"left":this.position.x-=1,"uploadSolution"==window.from&&n.recordSolutionStep.push("L")}("uploadSolution"==window.from||window.setting.relast&&cc.sys.platform===cc.sys.WECHAT_GAME)&&wx.setStorage({key:"lastLayout",data:window.currentLevel,success:function(){wx.getStorage({key:"lastLayout",success:function(e){n.moveHistoryList.push(e.data)}})}}),this.stepCounterValue++,this.stepCounter&&(this.stepCounter.string="\u6b65\u6570\uff1a"+this.stepCounterValue);for(var i=0,o=0;o<window.currentLevel.length;o++)for(var t=0;t<window.currentLevel[0].length;t++)window.currentLevel[o][t].cover&&2==window.currentLevel[o][t].sign&&(i++,this.boxNum==i&&this.showResult());window.moveMusic&&!window.moveMusic.paused&&window.moveMusic.stop(),window.moveMusic&&!window.moveMusic.paused&&window.moveMusic.pause(),window.moveMusic&&window.moveMusic.play()},addTouchMove:function(){if(window.setting.touchMove&&"checkSolution"!=window.from){var e=this,n=null;this.node.on("touchstart",function(e){n=e.getLocation()},this),this.node.on("touchend",function(i){var o=i.getLocation();Math.abs(n.x-o.x)>Math.abs(n.y-o.y)?n.x-o.x<-50?e.moveRight(window.currentLevel):n.x-o.x>50&&e.moveLeft(window.currentLevel):n.y-o.y<-50?e.moveUp(window.currentLevel):n.y-o.y>50&&e.moveDown(window.currentLevel)},this)}},showResult:function(e){var n=this;if(n.timeCounterTimer&&(clearInterval(n.timeCounterTimer),n.timeCounterTimer=null),"review"!=window.from&&"checkSolution"!=window.from){var o=this.node;if(o){var t=function(e,t){if(e)console.log("Prefab error:"+e);else if(t instanceof cc.Prefab){var c=cc.instantiate(t);cc.find("contentBg/useTime",c).getComponent(cc.Label).string="\u6b65\u6570\uff1a"+n.stepCounterValue+"\u6b65",cc.find("contentBg/useStep",c).getComponent(cc.Label).string="\u7528\u65f6\uff1a"+n.timeCounterValue+"\u79d2","build"==window.from?(cc.find("contentBg/next/Background/Label",c).getComponent(cc.Label).string="\u4e0a\u4f20\u5173\u5361",cc.find("contentBg/next",c).on("click",function(){i.Loading.show(),wx.request({url:cloudFunctionBaseUrl+"/getReviewLevelNum",method:"POST",data:{},success:function(e){wx.request({url:cloudFunctionBaseUrl+"/addReviewLevel",method:"POST",data:{content:window.uploadLevel,useStepNum:n.stepCounterValue,levelIndex:e.data.total+1,appId:window.user.appId,nickName:window.loginInfo.nickName?window.loginInfo.nickName:"\u6e38\u5ba2"+window.user.appId.substring(window.user.appId.length-5),portrait:window.loginInfo.avatarUrl},success:function(){parseInt(e.data.total),window.from="game",i.Loading.hide(),window.createScenseUploadAd?((0,i.Toast)("\u5173\u5361\u4e0a\u4f20\u6210\u529f\u5f85\u5ba1\u6838\uff0c\u5173\u95ed\u5e7f\u544a\u540e\u8df3\u56de\u4e3b\u754c\u9762",2e3),setTimeout(function(){window.createScenseUploadAd.show().catch(function(){cc.director.loadScene("main")}),window.createScenseUploadAd.onClose(function(){cc.director.loadScene("main")})},1500)):((0,i.Toast)("\u5173\u5361\u4e0a\u4f20\u6210\u529f\u5f85\u7ba1\u7406\u5458\u5ba1\u6838\uff0c\u5373\u5c06\u8df3\u56de\u4e3b\u754c\u9762",1500),setTimeout(function(){cc.director.loadScene("main")},1500))},error:function(e){i.Loading.hide(),(0,i.Toast)("\u4e0a\u4f20\u5931\u8d25",1500),console.error(e)}})}})},this)):"uploadSolution"==window.from?(cc.find("contentBg/next/Background/Label",c).getComponent(cc.Label).string="\u4e0a\u4f20\u653b\u7565",cc.find("contentBg/next",c).on("click",function(){i.Loading.show(),null!=window.lastSolutionStep?window.lastSolutionStep>n.stepCounterValue?wx.request({url:cloudFunctionBaseUrl+"/updateClassicsLevelSolution",method:"POST",data:{levelIndex:window.levelIndex,appId:window.user.appId,useStep:n.stepCounterValue,useTime:n.timeCounterValue,portrait:window.loginInfo.avatarUrl,nickName:window.loginInfo.nickName,content:n.recordSolutionStep.join()},success:function(){(0,i.Toast)("\u653b\u7565\u4e0a\u4f20\u6210\u529f",1500),i.Loading.hide(),setTimeout(function(){cc.director.loadScene("game")},1e3)},error:function(){(0,i.Toast)("\u4e0a\u4f20\u5931\u8d25,\u8bf7\u7a0d\u540e\u518d\u8bd5",3e3),i.Loading.hide()}}):(i.Loading.hide(),(0,i.Toast)("\u539f\u6709\u653b\u7565\u6b65\u6570\u66f4\u5c11\uff0c\u4e0a\u4f20\u5931\u8d25",3e3)):wx.request({url:cloudFunctionBaseUrl+"/addClassicsLevelSolution",method:"POST",data:{levelIndex:window.levelIndex,appId:window.user.appId,useStep:n.stepCounterValue,useTime:n.timeCounterValue,portrait:window.loginInfo.avatarUrl,nickName:window.loginInfo.nickName,content:n.recordSolutionStep.join()},success:function(){(0,i.Toast)("\u653b\u7565\u4e0a\u4f20\u6210\u529f",1500),i.Loading.hide(),setTimeout(function(){cc.director.loadScene("game")},1e3)},error:function(){(0,i.Toast)("\u4e0a\u4f20\u5931\u8d25,\u8bf7\u7a0d\u540e\u518d\u8bd5",3e3),i.Loading.hide()}})},this)):"build"!=window.from&&(window.levelIndex>=window.classicsLevelNum?(cc.find("contentBg/next/Background/Label",c).getComponent(cc.Label).string="\u56de\u4e3b\u754c\u9762",cc.find("contentBg/next",c).on("click",function(){clearInterval(n.timeCounterTimer),n.timeCounterTimer=null,cc.director.loadScene("main"),window.from="game"},this)):cc.find("contentBg/next",c).on("click",function(){c.removeFromParent(),c.destroy(),n.initPendant(),window.levelIndex++,n.initLevel()},this)),cc.find("contentBg/replay",c).on("click",function(){"uploadSolution"!=window.from?(c.removeFromParent(),c.destroy(),n.replayLayout()):cc.director.loadScene("game")},this),cc.find("contentBg/rank",c).on("click",function(){"build"!=window.from?n.showLevelRank():(0,i.Toast)("\u6d4b\u8bd5\u5173\u5361\u6ca1\u6709\u6392\u884c\u699c",1500)},this),cc.find("contentBg/share",c).on("click",function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){var e="\u76ca\u667a\u63a8\u7bb1";"build"!=window.from?e=e+"\u7b2c"+window.levelIndex+"\u5173-\u4f7f\u7528\u6b65\u6570\uff1a"+n.stepCounterValue+"-\u6311\u6218\u6210\u529f\uff01":e+="\u5c0f\u6e38\u620f\uff0c\u5feb\u6765\u6311\u6218\u5427\uff01",wx.shareAppMessage({title:e,query:"\u5206\u4eab"})}},this),o.addChild(c)}else console.log("Prefab error")};if(setTimeout(function(){cc.loader.loadRes("gameOverAlert",t)},0),"build"!=window.from&&("skip"==e&&(n.stepCounterValue="9999",n.timeCounterValue="9999"),cc.sys.platform===cc.sys.WECHAT_GAME)){null==n.lastScore?(i.Loading.show(),(0,i.Toast)("\u4e0a\u4f20\u5206\u6570\u4e2d...",1500),wx.request({url:cloudFunctionBaseUrl+"/addClassicsLevelScore",method:"POST",data:{levelIndex:window.levelIndex,appId:window.user.appId,useStep:n.stepCounterValue,useTime:n.timeCounterValue,portrait:window.loginInfo.avatarUrl,nickName:window.loginInfo.nickName?window.loginInfo.nickName:"\u6e38\u5ba2"+window.user.appId.substring(window.user.appId.length-5)},success:function(){i.Loading.hide()},error:function(){i.Loading.hide()}}),n.lastScore={levelIndex:window.levelIndex,appId:window.user.appId,useStep:n.stepCounterValue,useTime:n.timeCounterValue},n.renderLastScore(n.lastScore.useStep,n.lastScore.useTime)):n.stepCounterValue<n.lastScore.useStep&&(n.lastScore={levelIndex:window.levelIndex,appId:window.user.appId,useStep:n.stepCounterValue,useTime:n.timeCounterValue},n.renderLastScore(n.lastScore.useStep,n.lastScore.useTime),i.Loading.show(),(0,i.Toast)("\u4e0a\u4f20\u5206\u6570\u4e2d...",1500),wx.request({url:cloudFunctionBaseUrl+"/updateClassicsLevelScore",method:"POST",data:{levelIndex:window.levelIndex,appId:window.user.appId,useStep:n.stepCounterValue,useTime:n.timeCounterValue,portrait:window.loginInfo.avatarUrl,nickName:window.loginInfo.nickName},success:function(){i.Loading.hide()},error:function(){i.Loading.hide()}}));var c=window.levelIndex;wx.request({url:cloudFunctionBaseUrl+"/queryUser",method:"POST",data:{appId:window.user.appId},success:function(e){if(e&&e.data.data.length>0&&e.data.data[0].levelFinishNum<c){window.user.levelFinishNum=c;var n={};n.appId=window.user.appId,n.levelFinishNum=c,window.loginInfo.nickName&&(n.nickName=window.loginInfo.nickName),window.loginInfo.avatarUrl&&(n.portrait=window.loginInfo.avatarUrl),wx.request({url:cloudFunctionBaseUrl+"/updateUser",method:"POST",data:n,success:function(){},error:function(){}})}},error:function(){}})}}else cc.console("find Canvas error")}else(0,i.Toast)("\u6311\u6218\u6210\u529f\uff01",1500)},replayLayout:function(){var e=this;wx.getStorage({key:"initLevel",success:function(n){"uploadSolution"==window.from&&(e.recordSolutionStep=[]),window.currentLevel=n.data,e.renderLayout(window.currentLevel),e.initPosition(window.currentLevel),e.initPendant()},fail:function(){}})},initPendant:function(){var e=this;if(null==this.levelCounter){var n=new cc.Node("levelCounter");n.setAnchorPoint(.5,.5),n.width=.7*cc.winSize.width,n.height=180;var i=n.addComponent(cc.Label);i.node.setPosition(0,cc.winSize.height/2-.05*cc.winSize.height),i.fontSize=60,i.enableBold=!0,i.lineHeight=60,window.levelBy?i.string=("\u7b2c "+window.levelIndex+" \u5173 - "+window.levelBy).substring(0,16):i.string="\u7b2c "+window.levelIndex+" \u5173",this.levelCounter=n.getComponent(cc.Label),this.node.addChild(n)}else window.levelBy?this.levelCounter.string=("\u7b2c "+window.levelIndex+" \u5173 - "+window.levelBy).substring(0,16):this.levelCounter.string="\u7b2c "+window.levelIndex+" \u5173";if("build"==window.from&&(this.levelCounter.string="\u6d4b\u8bd5\u5173\u5361"),"review"==window.from&&(this.levelCounter.string="\u5ba1\u6838\u5173\u5361",window.gameCircle&&(window.gameCircle.destroy(),window.gameCircle=null),window.auditLevelAd&&window.auditLevelAd.destroy(),cc.sys.platform===cc.sys.WECHAT_GAME&&!window.gameCircle)){var o=wx.getSystemInfoSync(),t=.6*o.windowWidth,c=.4*o.windowWidth/2;t<=300&&(c=(o.windowWidth-300)/2),window.auditLevelAd=wx.createBannerAd({adUnitId:"adunit-a1670c225334da27",style:{left:c,top:.08*o.windowHeight,width:t}}),window.auditLevelAd.onError(function(){}),window.auditLevelAd.onLoad(function(){window.auditLevelAd.show().catch(function(){})})}if("uploadSolution"==window.from&&(this.levelCounter.string="\u7b2c "+window.levelIndex+" \u5173 - \u4e0a\u4f20\u653b\u7565"),"checkSolution"!=window.from){if(null==this.stepCounter){var s=new cc.Node("stepCounter");s.setAnchorPoint(0,1);var l=s.addComponent(cc.Label);l.node.setPosition(-cc.winSize.width/2+.05*cc.winSize.width,cc.winSize.width/2+80),l.string="\u6b65\u6570\uff1a 0",this.stepCounter=s.getComponent(cc.Label),this.node.addChild(s)}else this.stepCounterValue=0,this.stepCounter&&(this.stepCounter.string="\u6b65\u6570\uff1a"+this.stepCounterValue);if(null==this.timeCounter){var a=new cc.Node("timeCounter");a.setAnchorPoint(0,1);var r=a.addComponent(cc.Label);r.node.setPosition(0,cc.winSize.width/2+80),r.string="\u7528\u65f6\uff1a 0",this.timeCounter=a.getComponent(cc.Label),this.node.addChild(a),this.timeCounterTimer=setInterval(function(){this.timeCounterValue++,this.timeCounter&&(this.timeCounter.string="\u7528\u65f6\uff1a"+this.timeCounterValue)}.bind(this),1e3)}else this.timeCounterValue=0,this.timeCounter.string="\u7528\u65f6\uff1a"+this.timeCounterValue,null==this.timeCounterTimer&&(this.timeCounterTimer=setInterval(function(){this.timeCounterValue++,this.timeCounter&&(this.timeCounter.string="\u7528\u65f6\uff1a"+this.timeCounterValue)}.bind(this),1e3));this.moveHistoryList.splice(0,this.moveHistoryList.length),wx.getStorage({key:"initLevel",success:function(n){e.moveHistoryList.push(n.data)}})}else this.levelCounter.string="\u7b2c "+window.levelIndex+" \u5173 - \u653b\u7565"},pendantAddEvent:function(){var e=this;cc.find("back",this.node).on("click",this.back,this),window.setting.clickMove&&"checkSolution"!=window.from?(cc.find("gameBtns/up",this.node).on("click",function(){e.moveUp(window.currentLevel)},this),cc.find("gameBtns/right",this.node).on("click",function(){e.moveRight(window.currentLevel)},this),cc.find("gameBtns/down",this.node).on("click",function(){e.moveDown(window.currentLevel)},this),cc.find("gameBtns/left",this.node).on("click",function(){e.moveLeft(window.currentLevel)},this)):(cc.find("gameBtns/up",this.node).removeFromParent(),cc.find("gameBtns/right",this.node).removeFromParent(),cc.find("gameBtns/down",this.node).removeFromParent(),cc.find("gameBtns/left",this.node).removeFromParent());var n=cc.find("gameBtns/backStep/Background/Label",this.node).getComponent(cc.Label);"review"==window.from?n.string="\u901a\u8fc7":"checkSolution"==window.from?n.string="Again":window.setting.relast||(n.string="\u91cd\u73a9"),cc.find("gameBtns/backStep",this.node).on("click",function(){var e=this;if("checkSolution"==window.from)return e.solutionStepIndex=-1,void e.replayLayout();if("review"!=window.from)window.setting.relast?e.moveHistoryList.length>1&&e.stepCounterValue>=1&&(e.moveHistoryList.pop(),"uploadSolution"==window.from&&e.recordSolutionStep.pop(),cc.sys.platform===cc.sys.WECHAT_GAME&&wx.setStorage({key:"lastLayout",data:e.moveHistoryList[e.moveHistoryList.length-1],success:function(){wx.getStorage({key:"lastLayout",success:function(n){e.stepCounterValue--,e.stepCounter.string="\u6b65\u6570\uff1a"+e.stepCounterValue,window.currentLevel=n.data,e.renderLayout(window.currentLevel),e.initPosition(window.currentLevel)}})}})):e.replayLayout();else{var n=cc.find("Canvas");if(!n)return void cc.console("find Canvas error");cc.loader.loadRes("verifyAdmin",function(o,t){if(o)console.log("Prefab error:"+o);else if(t instanceof cc.Prefab){var c=cc.instantiate(t);cc.find("verifyContain/close",c).on("click",function(){c.removeFromParent(),c.destroy()},this);var s=cc.find("verifyContain/editbox",c).getComponent(cc.EditBox);cc.find("verifyContain/confirm",c).on("click",function(){"19970720"==s.textLabel.string?(i.Loading.show(),wx.request({url:cloudFunctionBaseUrl+"/getClassicsLevelNum",method:"POST",data:{},success:function(n){wx.getStorage({key:"initLevel",success:function(o){wx.request({url:cloudFunctionBaseUrl+"/addClassicsLevel",method:"POST",data:{content:o.data,levelIndex:n.data.total+1,appId:window.uploadInfo.appId,nickName:window.uploadInfo.nickName?window.uploadInfo.nickName:"\u6e38\u5ba2"+window.uploadInfo.appId.substring(window.uploadInfo.appId.length-5),portrait:window.uploadInfo.avatarUrl},success:function(){wx.request({url:cloudFunctionBaseUrl+"/removeReviewLevel",method:"POST",data:{_id:window.reviewId},success:function(){var o=parseInt(n.data.total)+1;(0,i.Toast)("\u5173\u5361"+o+"\u4e0a\u4f20\u6210\u529f\uff0c\u5373\u5c06\u8df3\u56de\u4e3b\u754c\u9762",1500),setTimeout(function(){clearInterval(e.timeCounterTimer),e.timeCounterTimer=null,i.Loading.hide(),window.from="game",cc.director.loadScene("main")},1500)},error:function(){}})},error:function(){i.Loading.hide(),(0,i.Toast)("\u4e0a\u4f20\u5931\u8d25",1500)}})}})}})):(0,i.Toast)("\u5bc6\u7801\u9519\u8bef\uff01",1500)},this),n.addChild(c)}else console.log("Prefab error")})}},this),"review"==window.from?cc.find("gameBtns/menu/Background/Label",this.node).getComponent(cc.Label).string="\u9a73\u56de":"checkSolution"==window.from&&(cc.find("gameBtns/menu/Background/Label",this.node).getComponent(cc.Label).string="Next"),cc.find("gameBtns/menu",this.node).on("click",function(){if(clearInterval(e.timeCounterTimer),e.timeCounterTimer=null,"checkSolution"!=window.from)if("review"!=window.from)(n=e.node)?(o=function(o,t){if(o)console.log("Prefab error:"+o);else if(t instanceof cc.Prefab){var c=cc.instantiate(t);cc.find("contain/continue",c).on("click",function(){null==e.timeCounterTimer&&(e.timeCounterTimer=setInterval(function(){e.timeCounterValue++,e.timeCounter.string="\u7528\u65f6\uff1a"+e.timeCounterValue}.bind(e),1e3)),c.removeFromParent(),c.destroy()},this),cc.find("contain/replay",c).on("click",function(){c.removeFromParent(),c.destroy(),e.replayLayout()},this),cc.find("contain/levels",c).on("click",function(){var e=cc.find("Canvas");e?cc.loader.loadRes("levelLayout",function(n,i){if(n)console.log("Prefab error:"+n);else if(i instanceof cc.Prefab){var o=cc.instantiate(i);e.addChild(o)}else console.log("Prefab error")}):cc.console("find Canvas error")},this),cc.find("contain/rank",c).on("click",function(){"build"!=window.from?e.showLevelRank():(0,i.Toast)("\u6d4b\u8bd5\u5173\u5361\u6ca1\u6709\u6392\u884c\u699c",1500)},this),cc.find("contain/share",c).on("click",function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){var e="\u76ca\u667a\u63a8\u7bb1";"build"!=window.from?e=e+"\u7b2c"+window.levelIndex+"\u5173-\u5feb\u6765\u6311\u6218\u5427!":e+="\u5c0f\u6e38\u620f\uff0c\u5feb\u6765\u6311\u6218\u5427\uff01",wx.shareAppMessage({title:e,query:"\u5206\u4eab"})}},this),n.addChild(c)}else console.log("Prefab error")},cc.loader.loadRes("gameMenu",o)):cc.console("find Canvas error");else{var n;if(!(n=cc.find("Canvas")))return void cc.console("find Canvas error");var o=function(e,o){if(e)console.log("Prefab error:"+e);else if(o instanceof cc.Prefab){var t=cc.instantiate(o);cc.find("verifyContain/close",t).on("click",function(){t.removeFromParent(),t.destroy()},this);var c=cc.find("verifyContain/editbox",t).getComponent(cc.EditBox);cc.find("verifyContain/confirm",t).on("click",function(){"19970720"==c.textLabel.string?(i.Loading.show(),wx.request({url:cloudFunctionBaseUrl+"/removeReviewLevel",method:"POST",data:{_id:window.reviewId},success:function(){(0,i.Toast)("\u5173\u5361\u5df2\u9a73\u56de\uff0c\u5373\u5c06\u8df3\u56de\u4e3b\u754c\u9762",1500),setTimeout(function(){i.Loading.hide(),window.from="game",cc.director.loadScene("main")},1500)},error:function(){}})):(0,i.Toast)("\u5bc6\u7801\u9519\u8bef\uff01",1500)},this),n.addChild(t)}else console.log("Prefab error")};cc.loader.loadRes("verifyAdmin",o)}else{if(e.solutionStepIndex++,e.solutionStepIndex>=window.levelSolution.content.length&&(e.solutionStepIndex=-1),e.solutionStepIndex<=-1)return void e.replayLayout();switch(window.levelSolution.content[e.solutionStepIndex]){case"U":e.moveUp(window.currentLevel);break;case"R":e.moveRight(window.currentLevel);break;case"D":e.moveDown(window.currentLevel);break;case"L":e.moveLeft(window.currentLevel)}}},this)},initLevel:function(){var e=this;if(cc.sys.platform===cc.sys.WECHAT_GAME){if(i.Loading.show(),"build"==window.from)return e.lastScore=null,e.renderLastScore("\u65e0","\u65e0"),wx.getStorage({key:"buildLevel",success:function(n){window.currentLevel=n.data,e.renderLayout(window.currentLevel),e.initPosition(window.currentLevel),e.initPendant(),wx.setStorage({key:"initLevel",data:window.currentLevel,success:function(){wx.getStorage({key:"initLevel",success:function(n){e.moveHistoryList.push(n.data)}})}}),i.Loading.hide()}}),void wx.getStorage({key:"buildLevel",success:function(e){window.uploadLevel=e.data}});if("review"==window.from)return e.lastScore=null,e.renderLastScore("\u65e0","\u65e0"),void wx.getStorage({key:"reviewLevel",success:function(n){window.uploadLevel=n.data,window.currentLevel=n.data,e.renderLayout(window.currentLevel),e.initPosition(window.currentLevel),e.initPendant(),wx.setStorage({key:"initLevel",data:window.currentLevel,success:function(){wx.getStorage({key:"initLevel",success:function(n){e.moveHistoryList.push(n.data)}})}}),i.Loading.hide()}});if("classicsLevel"==window.levelClassify&&(wx.request({url:cloudFunctionBaseUrl+"/queryClassicsLevel",method:"POST",data:{appId:window.user.appId,levelIndex:window.levelIndex},success:function(n){n&&n.data.data.length>0&&(window.currentLevel=n.data.data[0].content,e.renderLayout(window.currentLevel),e.initPosition(window.currentLevel),window.levelBy=n.data.data[0].nickName,e.initPendant(),wx.setStorage({key:"initLevel",data:window.currentLevel,success:function(){e.moveHistoryList.push(window.currentLevel),e.replayLayout()}})),i.Loading.hide()},error:function(){}}),wx.request({url:cloudFunctionBaseUrl+"/queryClassicsLevelScore",method:"POST",data:{levelIndex:window.levelIndex,appId:window.user.appId},success:function(n){n&&n.data.data.length>0?(e.lastScore=n.data.data[0],e.renderLastScore(e.lastScore.useStep,e.lastScore.useTime)):(e.lastScore=null,e.renderLastScore("\u65e0","\u65e0"),1==window.levelIndex&&(0,i.Toast)("Tip: \u53ef\u6ed1\u52a8\u5c4f\u5e55\u63a7\u5236\u4eba\u7269",5e3))},error:function(){}})),"uploadSolution"!=window.from&&"checkSolution"!=window.from){var n=(new Date).toLocaleDateString(),o=new cc.Node("skipNode");o.setAnchorPoint(0,1);var t=o.addComponent(cc.Label);t.node.setPosition(cc.winSize.width/2-.2*cc.winSize.width,cc.winSize.width/2+80),t.string="\u76f8\u5173\u653b\u7565",e.solutionBtn=o.getComponent(cc.Label),e.node.addChild(o);var c=!0;wx.getStorage({key:"skipAdInfo",success:function(n){n.data.num>=5&&(e.noneSkipChange=!0)}}),e.solutionBtn.node.on("touchend",function(){if(c){c=!1,e.timeCounterTimer&&clearInterval(e.timeCounterTimer),e.timeCounterTimer=null;var o=cc.find("Canvas");o?(cc.loader.loadRes("solutionDialog",function(t,c){if(t)console.log("Prefab error:"+t);else if(c instanceof cc.Prefab){var s=cc.instantiate(c);cc.find("solutionContain/close",s).on("click",function(){null==e.timeCounterTimer&&(e.timeCounterTimer=setInterval(function(){e.timeCounterValue++,e.timeCounter&&(e.timeCounter.string="\u7528\u65f6\uff1a"+e.timeCounterValue)}.bind(e),1e3)),s.removeFromParent(),s.destroy()},this),cc.find("solutionContain/skipLevel",s).on("click",function(){e.lastScore?(0,i.Toast)("\u5f53\u524d\u5173\u5361\u5df2\u901a\u8fc7\u65e0\u9700\u518d\u8df3\u8fc7",1500):e.noneSkipChange?(0,i.Toast)("\u6bcf\u5929\u6700\u591a\u8df3\u8fc75\u4e2a\u5173\u5361",1500):((0,i.Toast)("\u5e7f\u544a\u62c9\u53d6\u4e2d...",1500),window.skipLevelAd?(window.skipLevelAd.show().catch(function(){window.skipLevelAd.load().then(function(){return window.skipLevelAd.show()}).catch(function(){(0,i.Toast)("\u5e7f\u544a\u62c9\u53d6\u5931\u8d25",1500)})}),window.skipLevelAd.offClose(),window.skipLevelAd.onClose(function(i){(i&&i.isEnded||void 0===i)&&(null==e.timeCounterTimer&&(e.timeCounterTimer=setInterval(function(){e.timeCounterValue++,e.timeCounter&&(e.timeCounter.string="\u7528\u65f6\uff1a"+e.timeCounterValue)}.bind(e),1e3)),s.removeFromParent(),s.destroy(),e.showResult("skip"),wx.getStorage({key:"skipAdInfo",success:function(i){i.data.date==n?(i.data.num>=5&&(e.noneSkipChange=!0),wx.setStorage({key:"skipAdInfo",data:{date:n,num:i.data.num+1}})):wx.setStorage({key:"skipAdInfo",data:{date:n,num:1}})},fail:function(){wx.setStorage({key:"skipAdInfo",data:{date:n,num:1}})}}))})):(0,i.Toast)("\u5e7f\u544a\u62c9\u53d6\u5931\u8d25",1500))},this),cc.find("solutionContain/checkSolution",s).on("click",function(){wx.request({url:cloudFunctionBaseUrl+"/queryClassicsLevelSolution",method:"POST",data:{levelIndex:window.levelIndex},success:function(e){if(window.levelSolution=null,e&&e.data.data.length>0){if((0,i.Toast)("\u5e7f\u544a\u62c9\u53d6\u4e2d...",1500),!window.checkSolutionLevelAd)return void(0,i.Toast)("\u5e7f\u544a\u62c9\u53d6\u5931\u8d25",1500);window.checkSolutionLevelAd.show().catch(function(){window.checkSolutionLevelAd.load().then(function(){return window.checkSolutionLevelAd.show()}).catch(function(){(0,i.Toast)("\u5e7f\u544a\u62c9\u53d6\u5931\u8d25",1500)})}),window.checkSolutionLevelAd.offClose(),window.checkSolutionLevelAd.onClose(function(n){(n&&n.isEnded||void 0===n)&&(window.from="checkSolution",window.levelSolution=e.data.data[0],window.levelSolution.content=e.data.data[0].content.split(","),cc.director.loadScene("game"))})}else(0,i.Toast)("\u5f53\u524d\u5173\u5361\u6682\u65e0\u653b\u7565",3e3)},error:function(){}})},this),cc.find("solutionContain/uploadSolution",s).on("click",function(){window.from="uploadSolution",cc.director.loadScene("game")},this),o.addChild(s)}else console.log("Prefab error")}),setTimeout(function(){c=!0},1500)):cc.console("find Canvas error")}},e)}}},back:function(){this.initPendant(),clearInterval(this.timeCounterTimer),this.timeCounterTimer=null,"review"==window.from?cc.director.loadScene("main"):"uploadSolution"==window.from?(window.from="game",cc.director.loadScene("game")):"checkSolution"==window.from?(window.from="game",cc.director.loadScene("game")):"build"==window.from?(window.from="game",cc.director.loadScene("build")):(window.from="game",cc.director.loadScene("main"))},renderLastScore:function(e,n){var i,o,t=this;"build"!=window.from&&"review"!=window.from&&("uploadSolution"!=window.from?"checkSolution"!=window.from?null==t.lastStepNode?((i=new cc.Node("lastStepNode")).setAnchorPoint(0,1),(o=i.addComponent(cc.Label)).node.setPosition(-cc.winSize.width/2+.05*cc.winSize.width,cc.winSize.width/2+160),o.string="\u6700\u4f73\u6210\u7ee9\uff1a\u6b65\u6570 "+e+" - \u7528\u65f6 "+n,t.lastStepNode=i.getComponent(cc.Label),t.node.addChild(i)):t.lastStepNode.string="\u6700\u4f73\u6210\u7ee9\uff1a\u6b65\u6570 "+e+" - \u7528\u65f6 "+n:null==t.lastStepNode?((i=new cc.Node("lastStepNode")).setAnchorPoint(0,1),(o=i.addComponent(cc.Label)).node.setPosition(-cc.winSize.width/2+.05*cc.winSize.width,cc.winSize.width/2+160),o.string="\u5f53\u524d\u653b\u7565\uff1a\u6b65\u6570"+window.levelSolution.useStep+" - \u8d21\u732e\u8005\uff1a"+window.levelSolution.nickName.substring(0,16),t.lastStepNode=i.getComponent(cc.Label),t.node.addChild(i)):t.lastStepNode.string="\u5f53\u524d\u653b\u7565\uff1a\u6b65\u6570"+window.levelSolution.useStep+" - \u8d21\u732e\u8005\uff1a"+window.levelSolution.nickName.substring(0,16):wx.request({url:cloudFunctionBaseUrl+"/queryClassicsLevelSolution",method:"POST",data:{levelIndex:window.levelIndex},success:function(e){var n="\u5f53\u524d\u653b\u7565\uff1a\u6682\u65e0";if(window.lastSolutionStep=null,e&&e.data.data.length>0&&(window.lastSolutionStep=e.data.data[0].useStep,n="\u5f53\u524d\u653b\u7565\uff1a\u6b65\u6570"+e.data.data[0].useStep+" - \u8d21\u732e\u8005\uff1a"+e.data.data[0].nickName.substring(0,16)),null==t.lastStepNode){var i=new cc.Node("lastStepNode");i.setAnchorPoint(0,1);var o=i.addComponent(cc.Label);o.node.setPosition(-cc.winSize.width/2+.05*cc.winSize.width,cc.winSize.width/2+160),o.string=n,t.lastStepNode=i.getComponent(cc.Label),t.node.addChild(i)}else t.lastStepNode.string=n},error:function(){}}))},showLevelRank:function(){var e=this,n=cc.find("Canvas"),i=1;n?cc.loader.loadRes("rankLayout",function(o,t){if(o)console.log("Prefab error:"+o);else if(t instanceof cc.Prefab){var c=cc.instantiate(t),s=cc.find("rankList/view/content",c);cc.find("close",c).on("click",function(){c.removeFromParent(),c.destroy()},this),null==e.rankItem?cc.loader.loadRes("rankItem",function(n,o){e.rankItem=cc.instantiate(o),e.renderLevelRankList(s,i,50)}):e.renderLevelRankList(s,i,50),cc.find("rankList",c).on("bounce-bottom",function(){i++,e.renderLevelRankList(s,i,50)},this),cc.find("thLevel",c).getComponent(cc.Label).string="\u6b65 \u6570",n.addChild(c)}else console.log("Prefab error")}):cc.console("find Canvas error")},renderLevelRankList:function(e,n,o){var t=this,c=e.childrenCount;cc.sys.platform===cc.sys.WECHAT_GAME&&(i.Loading.show(),wx.request({url:cloudFunctionBaseUrl+"/queryClassicsLevelScore",method:"POST",data:{levelIndex:window.levelIndex,page:n,pageSize:o},success:function(n){i.Loading.hide();var o=null;if(n&&n.data.data.length>0){for(var s=function(){a=n.data.data[l-1];var s=cc.instantiate(t.rankItem);null==o&&(o=s),s.getChildByName("tdRank").getComponent(cc.Label).string=l+c,s.getChildByName("tdDate").getComponent(cc.Label).string=(0,i.formateRankTime)(a.createTime),s.getChildByName("tdLevel").getComponent(cc.Label).string=a.useStep,a.portrait&&cc.assetManager.loadRemote(a.portrait+"?aaa=aa.jpg",function(e,n){var i=new cc.SpriteFrame(n);cc.find("mask/Image",s.getChildByName("tdPortrait")).getComponent(cc.Sprite).spriteFrame=i}),a.nickName&&(s.getChildByName("tdName").getComponent(cc.Label).string=" "+a.nickName+" "),e.addChild(s)},l=1;l<=n.data.data.length;l++){var a;s()}e.height=e.childrenCount*o.height}else(0,i.Toast)("\u6ca1\u6709\u66f4\u591a\u6570\u636e\u4e86",1500)},error:function(){i.Loading.hide()}}))},timestampToTime:function(e){var n=new Date(e);return n.getFullYear()+"\u5e74"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)+"\u6708"+(n.getDate()<10?"0"+n.getDate():n.getDate())+"\u65e5 "+(n.getHours()<10?"0"+n.getHours():n.getHours())+":"+(n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes())+":"+(n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds())},onDestroy:function(){window.auditLevelAd&&window.auditLevelAd.destroy()}}),cc._RF.pop()},{"./common":"common"}],levelItem:[function(e,n){"use strict";cc._RF.push(n,"2cfd6DcvT5OTYgzh6qWc2QW","levelItem"),cc.Class({extends:cc.Component,properties:{levelNum:null,levelLock:null},start:function(){},init:function(){this.levelNum=cc.find("levelNum",this.node).getComponent(cc.Label),this.levelNum.string="1",this.levelLock=cc.find("levelLock",this.node),this.levelLock.opacity=0}}),cc._RF.pop()},{}],levelLayout:[function(e,n){"use strict";cc._RF.push(n,"fef7dUI0+VDDZg/zyXQW1yR","levelLayout"),cc.Class({extends:cc.Component,properties:{levelItem:cc.Prefab,levelList:null,levelListConten:null,levelSrollView:null,classicsLevelBtn:cc.Button,netLevelBtn:cc.Button,closeLevelBtn:cc.Button},onLoad:function(){},start:function(){this.levelList=cc.find("levelList/levelScrollView/view/content/itemList",this.node),this.levelListConten=cc.find("levelList/levelScrollView/view/content",this.node),this.levelSrollView=cc.find("levelList/levelScrollView",this.node),null==this.classicsLevelBtn&&(this.classicsLevelBtn=cc.find("levelList/classify/classicsLevel",this.node).getComponent(cc.Button)),null==this.netLevelBtn&&(this.netLevelBtn=cc.find("levelList/classify/netLevel",this.node).getComponent(cc.Button)),null==this.closeLevelBtn&&(this.closeLevelBtn=cc.find("closeLevel",this.node).getComponent(cc.Button)),this.classicsLevelBtn.node.on("click",this.loadClassicsLevelList,this),this.netLevelBtn.node.on("click",this.loadNetLevelList,this),this.closeLevelBtn.node.on("click",this.closeLevelLayout,this),this.loadClassicsLevelList()},loadClassicsLevelList:function(){var e=this;cc.find("Background/Label",this.classicsLevelBtn.node).color=cc.color(202,122,0);var n=cc.find("Background/Label",this.netLevelBtn.node);n.color=cc.color(255,255,255),n.opacity=125,window.levelClassify="classicsLevel",this.levelList.destroyAllChildren();for(var i=0,o=10,t=window.classicsLevelNum,c=function(n){var c=cc.instantiate(e.levelItem),s=n+1;(s<=window.user.levelFinishNum+1||window.user.roles&&window.user.roles.includes("admin"))&&(c.getChildByName("levelNum").getComponent(cc.Label).string=s,c.getChildByName("levelLock").opacity=0,c.on("touchend",function(){window.levelIndex=s,window.wxLoginBtn&&window.wxLoginBtn.destroy(),cc.director.loadScene("game")},e)),e.levelList.addChild(c),s<=o&&(o=Math.floor(t/Math.floor(e.levelListConten.width/c.width)-1),i+=c.height+70)},s=0;s<t;s++)c(s);this.levelListConten.height=i+.2*cc.winSize.height},loadNetLevelList:function(){var e=this,n=cc.find("Background/Label",this.classicsLevelBtn.node);n.color=cc.color(255,255,255),n.opacity=125,cc.find("Background/Label",this.netLevelBtn.node).color=cc.color(202,122,0),window.levelClassify="netLevel",this.levelList.destroyAllChildren();for(var i=0,o=10,t=window.netLevelNum,c=function(n){var c=cc.instantiate(e.levelItem),s=n+1;s<=window.userInfo.classicsLevelNum&&(c.getChildByName("levelNum").getComponent(cc.Label).string=s,c.getChildByName("levelLock").opacity=0),e.levelList.addChild(c),c.on("touchend",function(){cc.log("level:"+s)},e),s<=o&&(o=Math.floor(t/Math.floor(e.levelListConten.width/c.width)-1),i+=c.height+70)},s=0;s<t;s++)c(s);this.levelListConten.height=i+.2*cc.winSize.height},closeLevelLayout:function(){this.node.removeFromParent(),this.node.destroy()}}),cc._RF.pop()},{}],level:[function(e,n,i){"use strict";cc._RF.push(n,"8303276hNVKza2rc2TmzBRT","level"),i.__esModule=!0,i.default=void 0;for(var o=new Array,t=new Array,c=new Array,s=0;s<12;s++){t[s]=new Array,c[s]=new Array;for(var l=0;l<12;l++)t[s][l]={x:null,y:null,sign:0,cover:null},c[s][l]={x:null,y:null,sign:0,cover:null}}t[1][3].sign=1,t[1][4].sign=1,t[1][5].sign=1,t[2][3].sign=1,t[2][4].sign=3,t[2][5].sign=1,t[3][3].sign=1,t[3][4].sign=0,t[3][5].sign=1,t[3][6].sign=1,t[3][7].sign=1,t[3][8].sign=1,t[4][1].sign=1,t[4][2].sign=1,t[4][3].sign=1,t[4][4].sign=2,t[4][5].sign=0,t[4][6].sign=2,t[4][7].sign=3,t[4][8].sign=1,t[5][1].sign=1,t[5][2].sign=3,t[5][3].sign=0,t[5][4].sign=2,t[5][5].sign=6,t[5][6].sign=1,t[5][7].sign=1,t[5][8].sign=1,t[6][1].sign=1,t[6][2].sign=1,t[6][3].sign=1,t[6][4].sign=1,t[6][5].sign=2,t[6][6].sign=1,t[7][4].sign=1,t[7][5].sign=3,t[7][6].sign=1,t[8][4].sign=1,t[8][5].sign=1,t[8][6].sign=1,c[1][1].sign=1,c[1][2].sign=1,c[1][3].sign=1,c[1][4].sign=1,c[1][5].sign=1,c[2][1].sign=1,c[2][2].sign=6,c[2][5].sign=1,c[3][1].sign=1,c[3][3].sign=2,c[3][4].sign=2,c[3][5].sign=1,c[3][7].sign=1,c[3][8].sign=1,c[3][9].sign=1,c[4][1].sign=1,c[4][3].sign=2,c[4][5].sign=1,c[4][7].sign=1,c[4][8].sign=3,c[4][9].sign=1,c[5][1].sign=1,c[5][2].sign=1,c[5][3].sign=1,c[5][5].sign=1,c[5][6].sign=1,c[5][7].sign=1,c[5][8].sign=3,c[5][9].sign=1,c[6][2].sign=1,c[6][3].sign=1,c[6][8].sign=3,c[6][9].sign=1,c[7][2].sign=1,c[7][6].sign=1,c[7][9].sign=1,c[8][2].sign=1,c[8][6].sign=1,c[8][7].sign=1,c[8][8].sign=1,c[8][9].sign=1,c[9][2].sign=1,c[9][3].sign=1,c[9][4].sign=1,c[9][5].sign=1,c[9][6].sign=1,o.push(t,c);var a=o;i.default=a,n.exports=i.default,cc._RF.pop()},{}],main:[function(e,n){"use strict";cc._RF.push(n,"2276c+jCHZBGYX+JxzXyKDF","main");var i=e("./common");window.env="cloud1-5gvbuiy3dd99f63c",window.bgMusic=null,window.moveMusic=null,window.createScenseUploadAd=null,window.skipLevelAd=null,window.auditLevelAd=null,window.checkSolutionLevelAd=null,window.gameCircle=null,window.cloudFunctionBaseUrl="https://ac327917-ed0d-4195-8290-65fac58e2bf9.bspapp.com",window.auditLevelAd&&window.auditLevelAd.destroy(),cc.sys.platform===cc.sys.WECHAT_GAME&&(wx.cloud.init({env:window.env}),wx.createInterstitialAd&&(window.skipLevelAd=wx.createRewardedVideoAd({adUnitId:"adunit-d408eadf9ac9c0a9",multiton:!0}),window.skipLevelAd.onError(function(){}),window.checkSolutionLevelAd=wx.createRewardedVideoAd({adUnitId:"adunit-110d097df5bc8eb0",multiton:!0}),window.checkSolutionLevelAd.onError(function(){}),window.createScenseUploadAd=wx.createInterstitialAd({adUnitId:"adunit-e7f23b52c9d59315"}),window.createScenseUploadAd.onError(function(){window.createScenseUploadAd=null}))),window.user={},window.classicsLevelNum=0,window.netLevelNum=0,window.levelIndex=0,window.bgUrlBase="",window.user.levelFinishNum=0,window.loginInfo={avatarUrl:null,nickName:null},window.gameCircle=null,cc.Class({extends:cc.Component,properties:{oneSayLabel:{default:null,type:cc.Label},loginplay:cc.Button,visitorplay:cc.Button,mainRank:cc.Button,levelLayout:cc.Prefab,reviewLayout:cc.Prefab,reviewLevel:cc.Button,buildLevel:cc.Button,setting:cc.Button,mainShare:cc.Button,rankItem:cc.Prefab},onLoad:function(){this.mainBindEvent(),window.from="main",cc.game.on(cc.game.EVENT_SHOW,function(){window.bgMusic&&!window.bgMusic.paused&&window.bgMusic.pause(),window.bgMusic&&window.bgMusic.paused&&window.bgMusic.play()},this)},start:function(){cc.sys.platform===cc.sys.WECHAT_GAME&&(i.Loading.show(),wx.request({url:cloudFunctionBaseUrl+"/getClassicsLevelNum",method:"POST",data:{},success:function(e){window.classicsLevelNum=e.data.total,i.Loading.hide()},error:function(){i.Loading.hide()}}),wx.removeStorage({key:"initLevel"})),this.loadImg(),this.oneSay(),this.getUserInfo(),this.initSetting()},loadImg:function(){var e=cc.find("Canvas/mainBg/bingBg"),n="",i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&i.status>=200&&i.status<400){var o=JSON.parse(i.responseText);n="https://cn.bing.com"+o.images[0].urlbase+"_720x1280.jpg",window.bgUrlBase="https://cn.bing.com"+o.images[0].urlbase,cc.assetManager.loadRemote(n,function(n,i){var o=new cc.SpriteFrame(i);e.spriteFrame=o;var t=new cc.Node;t.name="star1",t.setPosition(0,0);var c=t.addComponent(cc.Sprite);c.spriteFrame=o,c.sizeMode="CUSTOM",c.node.width=cc.winSize.width,c.node.height=cc.winSize.height,t.opacity=0,e.addChild(t);var s=0,l=setInterval(function(){s+=1,t.opacity=s,s>=255&&(clearInterval(l),l=null)},5)})}},i.open("get","https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1",!0),i.send()},oneSay:function(){var e=this,n="https://v1.hitokoto.cn/",i=new XMLHttpRequest,o=cc.find("Canvas/mainBg/oneSay").getComponent(cc.Label);i.onreadystatechange=function(){if(4==i.readyState&&i.status>=200&&i.status<400){var n=JSON.parse(i.responseText);e.oneSayLabel&&null!=e.oneSayLabel.string?e.oneSayLabel.string=n.hitokoto+" -- "+n.from:o&&null!=o.string&&(o.string=n.hitokoto+" -- "+n.from)}},i.open("get",n,!0),i.send(),this.oneSayLabel.node.on("touchend",function(){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&i.status>=200&&i.status<400){var n=JSON.parse(i.responseText);e.oneSayLabel&&null!=e.oneSayLabel.string?e.oneSayLabel.string=n.hitokoto+" -- "+n.from:o&&null!=o.string&&(o.string=n.hitokoto+" -- "+n.from)}},i.open("get",n,!0),i.send()},this)},loginLevelList:function(){window.loginType="wechat";var e=cc.find("Canvas");e?cc.loader.loadRes("levelLayout",function(n,i){if(n)console.log("Prefab error:"+n);else if(i instanceof cc.Prefab){var o=cc.instantiate(i);e.addChild(o)}else console.log("Prefab error")}):cc.console("find Canvas error")},visitorLevelList:function(){window.loginType="visitor";var e=cc.find("Canvas");e?cc.loader.loadRes("levelLayout",function(n,i){if(n)console.log("Prefab error:"+n);else if(i instanceof cc.Prefab){var o=cc.instantiate(i);e.addChild(o)}else console.log("Prefab error")}):cc.console("find Canvas error")},showReviewLevel:function(){var e=this,n=cc.find("Canvas"),i=1;n?cc.loader.loadRes("reviewLayout",function(o,t){if(o)console.log("Prefab error:"+o);else if(t instanceof cc.Prefab){var c=cc.instantiate(t),s=cc.find("reviewLevelList/view/content",c);cc.find("close",c).on("click",function(){c.removeFromParent(),c.destroy()},this),null==e.rankItem?cc.loader.loadRes("rankItem",function(n,o){e.rankItem=cc.instantiate(o),e.renderReviewLevelList(s,i,50)}):e.renderReviewLevelList(s,i,50),cc.find("reviewLevelList",c).on("bounce-bottom",function(){i++,e.renderReviewLevelList(s,i,50)},this),n.addChild(c)}else console.log("Prefab error")}):cc.console("find Canvas error")},renderReviewLevelList:function(e,n,o){var t=this,c=e.childrenCount;cc.sys.platform===cc.sys.WECHAT_GAME&&(i.Loading.show(),wx.request({url:cloudFunctionBaseUrl+"/queryReviewLevel",method:"POST",data:{page:n,pageSize:o},success:function(n){i.Loading.hide();var o=null;if(n&&n.data.data.length>0){for(var s=1;s<=n.data.data.length;s++)(function(s){var l=n.data.data[s-1],a=cc.instantiate(t.rankItem);null==o&&(o=a),a.getChildByName("tdRank").getComponent(cc.Label).string=s+c,a.getChildByName("tdDate").getComponent(cc.Label).string=(0,i.formateRankTime)(l.createTime),a.getChildByName("tdLevel").getComponent(cc.Label).string=l.useStepNum,l.portrait&&cc.assetManager.loadRemote(l.portrait+"?aaa=aa.jpg",function(e,n){var i=new cc.SpriteFrame(n);cc.find("mask/Image",a.getChildByName("tdPortrait")).getComponent(cc.Sprite).spriteFrame=i}),l.nickName&&(a.getChildByName("tdName").getComponent(cc.Label).string=" "+l.nickName+" "),a.on("touchend",function(){window.wxLoginBtn&&window.wxLoginBtn.destroy(),wx.setStorage({key:"reviewLevel",data:l.content,success:function(){window.uploadInfo={},window.from="review",window.reviewId=l._id,window.uploadInfo.appId=l.appId,window.uploadInfo.nickName=l.nickName,window.uploadInfo.portrait=l.portrait,window.uploadInfo.createTime=l.createTime,cc.director.loadScene("game")}})},this),e.addChild(a)})(s);e.height=e.childrenCount*o.height}else(0,i.Toast)("\u6ca1\u6709\u66f4\u591a\u6570\u636e\u4e86",1500)},error:function(){i.Loading.hide()}}))},showMainRank:function(){var e=this,n=cc.find("Canvas"),i=1;n?cc.loader.loadRes("rankLayout",function(o,t){if(o)console.log("Prefab error:"+o);else if(t instanceof cc.Prefab){var c=cc.instantiate(t),s=cc.find("rankList/view/content",c);cc.find("close",c).on("click",function(){c.removeFromParent(),c.destroy()},this),null==e.rankItem?cc.loader.loadRes("rankItem",function(n,o){e.rankItem=cc.instantiate(o),e.renderMainRankList(s,i,50)}):e.renderMainRankList(s,i,50),cc.find("rankList",c).on("bounce-bottom",function(){i++,e.renderMainRankList(s,i,50)},this),n.addChild(c)}else console.log("Prefab error")}):cc.console("find Canvas error")},renderMainRankList:function(e,n,o){var t=this,c=e.childrenCount;cc.sys.platform===cc.sys.WECHAT_GAME&&(i.Loading.show(),wx.request({url:cloudFunctionBaseUrl+"/queryUser",method:"POST",data:{page:n,pageSize:o},success:function(n){i.Loading.hide();var o=null;if(n&&n.data.data.length>0){for(var s=function(){a=n.data.data[l-1];var s=cc.instantiate(t.rankItem);null==o&&(o=s),s.getChildByName("tdRank").getComponent(cc.Label).string=l+c,s.getChildByName("tdDate").getComponent(cc.Label).string=(0,i.formateRankTime)(a.createTime),s.getChildByName("tdLevel").getComponent(cc.Label).string=a.levelFinishNum,a.portrait&&cc.assetManager.loadRemote(a.portrait+"?aaa=aa.jpg",function(e,n){var i=new cc.SpriteFrame(n);cc.find("mask/Image",s.getChildByName("tdPortrait")).getComponent(cc.Sprite).spriteFrame=i}),a.nickName&&(s.getChildByName("tdName").getComponent(cc.Label).string=" "+a.nickName+" "),e.addChild(s)},l=1;l<=n.data.data.length;l++){var a;s()}e.height=e.childrenCount*o.height}else(0,i.Toast)("\u6ca1\u6709\u66f4\u591a\u6570\u636e\u4e86",1500)},error:function(){i.Loading.hide()}}))},getUserInfo:function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.getStorage({key:"appId",success:function(e){window.user.appId=e.data,wx.request({url:cloudFunctionBaseUrl+"/queryUser",method:"POST",data:{appId:window.user.appId},success:function(e){e&&e.data.data.length>0&&(window.user.levelFinishNum=e.data.data[0].levelFinishNum,window.user.classicsLevelNum=e.data.data[0].classicsLevelNum,window.user.netLevelNum=e.data.data[0].netLevelNum,window.user.roles=e.data.data[0].roles)}})},fail:function(){wx.login({success:function(e){e.code&&wx.request({url:cloudFunctionBaseUrl+"/login",method:"POST",data:{code:e.code},success:function(e){console.log(e),e&&e.data&&(wx.setStorage({key:"appId",data:e.data}),window.user.appId=e.data,window.user.classicsLevelNum=0,window.user.netLevelNum=0,window.user.levelFinishNum=0,window.user.roles="",wx.request({url:cloudFunctionBaseUrl+"/queryUser",method:"POST",data:{appId:window.user.appId},success:function(e){e&&e.data.data.length<=0?wx.request({url:cloudFunctionBaseUrl+"/addUser",method:"POST",data:{appId:window.user.appId,nickName:window.loginInfo.nickName?window.loginInfo.nickName:"\u6e38\u5ba2"+window.user.appId.substring(window.user.appId.length-5),portrait:window.loginInfo.avatarUrl},success:function(){}}):(window.user.levelFinishNum=e.data.data[0].levelFinishNum,window.user.classicsLevelNum=e.data.data[0].classicsLevelNum,window.user.netLevelNum=e.data.data[0].netLevelNum,window.user.roles=e.data.data[0].roles)}}))}})}})}})},mainBindEvent:function(){var e=this;if((0,i.wxLogin)(function(e){window.loginInfo={avatarUrl:e.avatarUrl,nickName:e.nickName}},function(){console.log("\u6388\u6743\u5931\u8d25")},this.loginplay.node),null==this.loginplay&&(this.loginplay=cc.find("Canvas/mainBg/loginplay").getComponent(cc.Button)),this.loginplay.node.on("click",this.loginLevelList,this),null==this.visitorplay&&(this.visitorplay=cc.find("Canvas/mainBg/visitorplay").getComponent(cc.Button)),this.visitorplay.node.on("click",this.visitorLevelList,this),null==this.mainRank&&(this.mainRank=cc.find("Canvas/mainBg/mainRank").getComponent(cc.Button)),this.mainRank.node.on("click",this.showMainRank,this),null==this.reviewLevel&&(this.reviewLevel=cc.find("Canvas/mainBg/reviewLevel").getComponent(cc.Button)),this.reviewLevel.node.on("click",this.showReviewLevel,this),null==this.buildLevel&&(this.buildLevel=cc.find("Canvas/mainBg/buildLevel").getComponent(cc.Button)),this.buildLevel.node.on("click",function(){window.buildLevel=new Array,window.wxLoginBtn&&window.wxLoginBtn.destroy(),cc.director.loadScene("build")},this),null==this.mainShare&&(this.mainShare=cc.find("Canvas/mainBg/mainShare").getComponent(cc.Button)),this.mainShare.node.on("click",function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.shareAppMessage({title:"\u5feb\u6765\u6311\u6218\u201c\u76ca\u667a\u63a8\u7bb1\u201d\u5c0f\u6e38\u620f\u5427\uff01",query:"\u5206\u4eab"})},this),null==this.setting&&(this.setting=cc.find("Canvas/mainBg/setting").getComponent(cc.Button)),this.setting.node.on("click",function(){var n=cc.find("Canvas");n?cc.loader.loadRes("settingDialog",function(o,t){if(o)console.log("Prefab error:"+o);else if(t instanceof cc.Prefab){var c=cc.instantiate(t);cc.find("settingContain/closeSetting",c).on("click",function(){c.removeFromParent(),c.destroy()},this);var s=cc.find("settingContain/touchMove/Background/Label",c).getComponent(cc.Label),l=cc.find("settingContain/clickMove/Background/Label",c).getComponent(cc.Label),a=cc.find("settingContain/relast/Background/Label",c).getComponent(cc.Label),r=cc.find("settingContain/music/Background/Label",c).getComponent(cc.Label);window.setting.touchMove?s.string="\u5173\u95ed\u89e6\u6478\u79fb\u52a8":s.string="\u5f00\u542f\u89e6\u6478\u79fb\u52a8",window.setting.clickMove?l.string="\u5173\u95ed\u6309\u952e\u79fb\u52a8":l.string="\u5f00\u542f\u6309\u952e\u79fb\u52a8",window.setting.relast?a.string="\u5173\u95ed\u56de\u9000\u529f\u80fd":a.string="\u5f00\u542f\u56de\u9000\u529f\u80fd",window.setting.music?r.string="\u5173\u95ed\u97f3\u6548":r.string="\u5f00\u542f\u97f3\u6548",cc.find("settingContain/touchMove",c).on("click",function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.getStorage({key:"setting",success:function(e){e.data.touchMove&&e.data.clickMove?(window.setting.touchMove=!1,s.string="\u5f00\u542f\u89e6\u6478\u79fb\u52a8"):!e.data.touchMove&&e.data.clickMove?(window.setting.touchMove=!0,s.string="\u5173\u95ed\u89e6\u6478\u79fb\u52a8"):(0,i.Toast)("\u81f3\u5c11\u5f00\u542f\u4e00\u79cd\u79fb\u52a8\u65b9\u5f0f!",1500),wx.setStorage({key:"setting",data:window.setting})}})},this),cc.find("settingContain/clickMove",c).on("click",function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.getStorage({key:"setting",success:function(e){e.data.touchMove&&e.data.clickMove?(window.setting.clickMove=!1,l.string="\u5f00\u542f\u6309\u952e\u79fb\u52a8"):e.data.touchMove&&!e.data.clickMove?(window.setting.clickMove=!0,l.string="\u5173\u95ed\u6309\u952e\u79fb\u52a8"):(0,i.Toast)("\u81f3\u5c11\u5f00\u542f\u4e00\u79cd\u79fb\u52a8\u65b9\u5f0f!",1500),wx.setStorage({key:"setting",data:window.setting})}})},this),cc.find("settingContain/relast",c).on("click",function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.getStorage({key:"setting",success:function(e){e.data.relast?(window.setting.relast=!1,a.string="\u5f00\u542f\u56de\u9000\u529f\u80fd"):(window.setting.relast=!0,a.string="\u5173\u95ed\u56de\u9000\u529f\u80fd"),wx.setStorage({key:"setting",data:window.setting})}})},this),cc.find("settingContain/music",c).on("click",function(){cc.sys.platform===cc.sys.WECHAT_GAME&&wx.getStorage({key:"setting",success:function(n){n.data.music?(window.setting.music=!1,r.string="\u5f00\u542f\u97f3\u6548"):(window.setting.music=!0,r.string="\u5173\u95ed\u97f3\u6548"),wx.setStorage({key:"setting",data:window.setting,complete:function(){e.setMusic()}})}})},this),n.addChild(c)}else console.log("Prefab error")}):cc.console("find Canvas error")},this),cc.sys.platform===cc.sys.WECHAT_GAME&&!window.gameCircle){var n=wx.getSystemInfoSync();window.gameCircle=wx.createGameClubButton({icon:"white",style:{left:.9*n.windowWidth-20,top:.12*n.windowHeight,width:40,height:40}})}},initSetting:function(){var e=this;cc.sys.platform===cc.sys.WECHAT_GAME&&wx.getStorage({key:"setting",success:function(e){window.setting=e.data},fail:function(){window.setting={touchMove:!0,clickMove:!0,relast:!1,music:!1},wx.setStorage({key:"setting",data:window.setting})},complete:function(){e.setMusic()}})},setMusic:function(){cc.sys.platform===cc.sys.WECHAT_GAME&&(window.setting.music?window.bgMusic&&window.moveMusic||(window.bgMusic=wx.createInnerAudioContext(),window.moveMusic=wx.createInnerAudioContext({useWebAudioImplement:!0}),cc.resources.load("music/bg_music",cc.AudioClip,null,function(e,n){window.bgMusic.src=n.url,window.bgMusic.loop=!0,window.bgMusic&&!window.bgMusic.paused&&window.bgMusic.pause(),window.bgMusic&&window.bgMusic.paused&&window.bgMusic.play()}),cc.resources.load("music/move_music",cc.AudioClip,null,function(e,n){window.moveMusic.src=n.url,window.moveMusic.loop=!1,window.moveMusic.playbackRate=2})):(window.bgMusic&&(window.bgMusic.stop(),window.bgMusic.destroy()),window.moveMusic&&(window.moveMusic.stop(),window.moveMusic.destroy()),window.bgMusic=null,window.moveMusic=null))}}),cc._RF.pop()},{"./common":"common"}]},{},["build","common","eleSize","gameLayout","level","levelItem","levelLayout","main"]);